---
title: "SSD Sensitivity Analysis"
author: "Scott Coffin"
date: "4/5/2021"
output:   
  html_document:
    code_folding: hide
    theme: journal
    toc: yes
    toc_float: yes
    toc_depth: 6
    number_sections: true
    includes:
     # after_body: footer.html
  word_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      warning=FALSE, message=FALSE,time_it = TRUE) #report
```

```{r libraries, include=FALSE}
library(tidyverse)
library(calecopal)
library(ssdtools)
library(DT)
library(plotly)
library(gridExtra)
library(grid)
library(wesanderson)
library(ggdark)
library(broom)
library(knitr)
library(viridis)
library(ggrepel)
library(scales)
library(gt)
```

```{r parameters, include=FALSE}
## Bart suggests using 1-30 um for SSD because it captures bioavailability fairly well
# Paramaters
x2D_set = 5000 #100 #upper size range (microns)
x1D_set = 100 #1 #lower size range (microns)
particle_mass_check_ssd <- 'particles/L' #assign whether or not to use particles/L or ug/L (note that 1,000x correction occurs to conver mg/L to ug/L and particles/mL to particles/L)
#dose_check <- "dose.mg.L.master" #assign whether to use particles/mL or mg/L #
dose_check <- as.vector('dose.particles.mL.master')
```

```{r Theme, include=FALSE}
#Theme type
     theme.type<- theme_gray(base_size = 20)#,
                  #     dark_theme_bw(base_size = 20)
     #color selection
     fill.type <-    scale_fill_viridis(discrete = TRUE)#,
                         #scale_fill_brewer(palette = "Paired"),
                         # scale_fill_tron(),
                         # scale_fill_locuszoom(),
                         # scale_fill_d3(),
                         # scale_fill_npg(),
                         # scale_fill_jama())
     #color selection
     color.type <- scale_color_viridis(discrete = TRUE)#,
                         # scale_color_brewer(palette = "Paired"),
                         # scale_color_tron(),
                         # scale_color_locuszoom(),
                         # scale_color_d3(),
                         # scale_color_npg(),
                         # scale_color_jama())

```

```{r import, include=FALSE}
# Data Import
#require(readr)
#load aoc_z into dataframe. This file is generated from RDA_Maker.R
#source("Tox Data/RDA_Maker.R")
aoc_z <- readRDS(file = "Tox Data/aoc_z.Rda")

## First filter data with global filters
aoc_final <- aoc_z %>% 
  filter(!environment %in% c("Terrestrial", "Not Reported"),
         org_f != "Bacterium",
         org_f != "Plant")
```

# Data Collapse
## Tech and Risk Tier Pass

```{r data collapse, include=FALSE}
#### filter by tier first ###
#Tier 1 is HC5 for all endpoints
tier1 <- aoc_final %>% 
  filter(tier_zero_tech_f == "Red Criteria Passed",
         tier_zero_risk_f == "Red Criteria Passed") %>% 
         # lvl1_f == "Fitness") %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#Tier 2 is HC5 for all tissue and above endpoints
tier2 <- aoc_final %>% 
  filter(tier_zero_tech_f == "Red Criteria Passed",
         tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Tissue","Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#Tiers 3 and 4 are for organism level endpoints only
tier3.4 <- aoc_final %>% 
  filter(tier_zero_tech_f == "Red Criteria Passed",
         tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#### Size filters ####
### 100 - 5000 um
tier1_large <- tier1 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
tier1_large.obs <- tier1_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tier2_large <- tier2 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
tier2_large.obs <- tier2_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tier3.4_large <- tier3.4 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
tier3.4_large.obs <- tier3.4_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

### 10 - 100 um
tier1_small <- tier1 %>% 
  filter(size_f %in% c("1µm < 10µm"))
# Count observations and studies
tier1_small.obs <- tier1_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tier2_small <- tier2 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
tier2_small.obs <- tier2_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tier3.4_small <- tier3.4 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
tier3.4_small.obs <- tier3.4_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

#### Data Collapsing ####

## Tier 1 ##
# tier 1 large
tier1_large_median <- tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tier1_large_mean <- tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tier1_large_1q <- tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tier1_large_min <- tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# tier 1 small
tier1_small_median <- tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tier1_small_mean <- tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tier1_small_1q <- tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tier1_small_min <- tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## Tier 2 ##
# tier 1 large
tier2_large_median <- tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tier2_large_mean <- tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tier2_large_1q <- tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tier2_large_min <- tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# tier 1 small
tier2_small_median <- tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tier2_small_mean <- tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tier2_small_1q <- tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tier2_small_min <- tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## Tier 3 and 4 ##
# tier 3 large
tier3.4_large_median <- tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tier3.4_large_mean <- tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tier3.4_large_1q <- tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tier3.4_large_min <- tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# tier 3 small
tier3.4_small_median <- tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tier3.4_small_mean <- tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tier3.4_small_1q <- tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25), na.rm = TRUE)

tier3.4_small_min <- tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))
```

## Risk Tier Pass, Tech Tier Fail
```{r include=FALSE}
#### filter by risk.pass.tier first ###
#risk.pass.tier 1 is HC5 for all endpoints
risk.pass.tier1 <- aoc_final %>% 
  filter(# tier_zero_tech_f == "Red Criteria Passed",
         tier_zero_risk_f == "Red Criteria Passed") %>% 
         # lvl1_f == "Fitness") %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#risk.pass.tier 2 is HC5 for all tissue and above endpoints
risk.pass.tier2 <- aoc_final %>% 
  filter(# tier_zero_tech_f == "Red Criteria Passed",
         tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Tissue","Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#risk.pass.tiers 3 and 4 are for organism level endpoints only
risk.pass.tier3.4 <- aoc_final %>% 
  filter(# tier_zero_tech_f == "Red Criteria Passed",
         tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#### Size filters ####
### 100 - 5000 um
risk.pass.tier1_large <- risk.pass.tier1 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
risk.pass.tier1_large.obs <- risk.pass.tier1_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

risk.pass.tier2_large <- risk.pass.tier2 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
risk.pass.tier2_large.obs <- risk.pass.tier2_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

risk.pass.tier3.4_large <- risk.pass.tier3.4 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
risk.pass.tier3.4_large.obs <- risk.pass.tier3.4_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

### 10 - 100 um
risk.pass.tier1_small <- risk.pass.tier1 %>% 
  filter(size_f %in% c("1µm < 10µm"))
# Count observations and studies
risk.pass.tier1_small.obs <- risk.pass.tier1_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

risk.pass.tier2_small <- risk.pass.tier2 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
risk.pass.tier2_small.obs <- risk.pass.tier2_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

risk.pass.tier3.4_small <- risk.pass.tier3.4 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
risk.pass.tier3.4_small.obs <- risk.pass.tier3.4_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

#### Data Collapsing ####

## risk.pass.tier 1 ##
# risk.pass.tier 1 large
risk.pass.tier1_large_median <- risk.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

risk.pass.tier1_large_mean <- risk.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

risk.pass.tier1_large_1q <- risk.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

risk.pass.tier1_large_min <- risk.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# risk.pass.tier 1 small
risk.pass.tier1_small_median <- risk.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

risk.pass.tier1_small_mean <- risk.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

risk.pass.tier1_small_1q <- risk.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

risk.pass.tier1_small_min <- risk.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## risk.pass.tier 2 ##
# risk.pass.tier 1 large
risk.pass.tier2_large_median <- risk.pass.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

risk.pass.tier2_large_mean <- risk.pass.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

risk.pass.tier2_large_1q <- risk.pass.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

risk.pass.tier2_large_min <- risk.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# risk.pass.tier 1 small
risk.pass.tier2_small_median <- risk.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

risk.pass.tier2_small_mean <- risk.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

risk.pass.tier2_small_1q <- risk.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

risk.pass.tier2_small_min <- risk.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## risk.pass.tier 3 and 4 ##
# risk.pass.tier 3 large
risk.pass.tier3.4_large_median <- risk.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

risk.pass.tier3.4_large_mean <- risk.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

risk.pass.tier3.4_large_1q <- risk.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

risk.pass.tier3.4_large_min <- risk.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# risk.pass.tier 3 small
risk.pass.tier3.4_small_median <- risk.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

risk.pass.tier3.4_small_mean <- risk.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

risk.pass.tier3.4_small_1q <- risk.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25), na.rm = TRUE)

risk.pass.tier3.4_small_min <- risk.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))
```

## Tech Tier Pass, Risk Tier Fail

```{r include=FALSE}
#### filter by tech.pass.tier first ###
#tech.pass.tier 1 is HC5 for all endpoints
tech.pass.tier1 <- aoc_final %>% 
  filter(tier_zero_tech_f == "Red Criteria Passed") %>% 
        # tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness") %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#tech.pass.tier 2 is HC5 for all tissue and above endpoints
tech.pass.tier2 <- aoc_final %>% 
  filter(tier_zero_tech_f == "Red Criteria Passed",
        # tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Tissue","Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#tech.pass.tiers 3 and 4 are for organism level endpoints only
tech.pass.tier3.4 <- aoc_final %>% 
  filter(tier_zero_tech_f == "Red Criteria Passed",
        # tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#### Size filters ####
### 100 - 5000 um
tech.pass.tier1_large <- tech.pass.tier1 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
tech.pass.tier1_large.obs <- tech.pass.tier1_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tech.pass.tier2_large <- tech.pass.tier2 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
tech.pass.tier2_large.obs <- tech.pass.tier2_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tech.pass.tier3.4_large <- tech.pass.tier3.4 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
tech.pass.tier3.4_large.obs <- tech.pass.tier3.4_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

### 10 - 100 um
tech.pass.tier1_small <- tech.pass.tier1 %>% 
  filter(size_f %in% c("1µm < 10µm"))
# Count observations and studies
tech.pass.tier1_small.obs <- tech.pass.tier1_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tech.pass.tier2_small <- tech.pass.tier2 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
tech.pass.tier2_small.obs <- tech.pass.tier2_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

tech.pass.tier3.4_small <- tech.pass.tier3.4 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
tech.pass.tier3.4_small.obs <- tech.pass.tier3.4_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

#### Data Collapsing ####

## tech.pass.tier 1 ##
# tech.pass.tier 1 large
tech.pass.tier1_large_median <- tech.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tech.pass.tier1_large_mean <- tech.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tech.pass.tier1_large_1q <- tech.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tech.pass.tier1_large_min <- tech.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# tech.pass.tier 1 small
tech.pass.tier1_small_median <- tech.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tech.pass.tier1_small_mean <- tech.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tech.pass.tier1_small_1q <- tech.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tech.pass.tier1_small_min <- tech.pass.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## tech.pass.tier 2 ##
# tech.pass.tier 1 large
tech.pass.tier2_large_median <- tech.pass.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tech.pass.tier2_large_mean <- tech.pass.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tech.pass.tier2_large_1q <- tech.pass.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tech.pass.tier2_large_min <- tech.pass.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# tech.pass.tier 1 small
tech.pass.tier2_small_median <- tech.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tech.pass.tier2_small_mean <- tech.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tech.pass.tier2_small_1q <- tech.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tech.pass.tier2_small_min <- tech.pass.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## tech.pass.tier 3 and 4 ##
# tech.pass.tier 3 large
tech.pass.tier3.4_large_median <- tech.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tech.pass.tier3.4_large_mean <- tech.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tech.pass.tier3.4_large_1q <- tech.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

tech.pass.tier3.4_large_min <- tech.pass.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# tech.pass.tier 3 small
tech.pass.tier3.4_small_median <- tech.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

tech.pass.tier3.4_small_mean <- tech.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

tech.pass.tier3.4_small_1q <- tech.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25), na.rm = TRUE)

tech.pass.tier3.4_small_min <- tech.pass.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))
```

## No quality filters

```{r include=FALSE}
#### filter by tier first ###
#allFail.tier 1 is HC5 for all endpoints
allFail.tier1 <- aoc_final %>% 
  #filter(#   tier_zero_tech_f == "Red Criteria Passed",
       #  tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness") %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#allFail.tier 2 is HC5 for all tissue and above endpoints
allFail.tier2 <- aoc_final %>% 
  filter(# tier_zero_tech_f == "Red Criteria Passed",
        # tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Tissue","Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#allFail.tiers 3 and 4 are for organism level endpoints only
allFail.tier3.4 <- aoc_final %>% 
  filter( # tier_zero_tech_f == "Red Criteria Passed",
         #tier_zero_risk_f == "Red Criteria Passed",
         # lvl1_f == "Fitness",
         bio_f %in% c("Organism","Population")) %>% 
  mutate(dose_new = dose.particles.mL.master / (af.time * af.noec)) %>%  #convert acute to chronic and NOEC to LOEC
  drop_na(dose_new)

#### Size filters ####
### 100 - 5000 um
allFail.tier1_large <- allFail.tier1 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
allFail.tier1_large.obs <- allFail.tier1_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

allFail.tier2_large <- allFail.tier2 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
allFail.tier2_large.obs <- allFail.tier2_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

allFail.tier3.4_large <- allFail.tier3.4 %>% 
  filter(size_f %in% c("10µm < 100µm", "100µm < 1mm", "1mm < 5mm"))
# Count observations and studies
allFail.tier3.4_large.obs <- allFail.tier3.4_large %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

### 10 - 100 um
allFail.tier1_small <- allFail.tier1 %>% 
  filter(size_f %in% c("1µm < 10µm"))
# Count observations and studies
allFail.tier1_small.obs <- allFail.tier1_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

allFail.tier2_small <- allFail.tier2 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
allFail.tier2_small.obs <- allFail.tier2_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

allFail.tier3.4_small <- allFail.tier3.4 %>% 
  filter(size_f %in% c("1µm < 10µm"))
## Count observations and studies
allFail.tier3.4_small.obs <- allFail.tier3.4_small %>% summarize(n.obs = n(), n.studies = n_distinct(doi), n.taxa = n_distinct(org_f), n.species = n_distinct(species_f))

#### Data Collapsing ####

## allFail.tier 1 ##
# allFail.tier 1 large
allFail.tier1_large_median <- allFail.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

allFail.tier1_large_mean <- allFail.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

allFail.tier1_large_1q <- allFail.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

allFail.tier1_large_min <- allFail.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# allFail.tier 1 small
allFail.tier1_small_median <- allFail.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

allFail.tier1_small_mean <- allFail.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

allFail.tier1_small_1q <- allFail.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

allFail.tier1_small_min <- allFail.tier1_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## allFail.tier 2 ##
# allFail.tier 1 large
allFail.tier2_large_median <- allFail.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

allFail.tier2_large_mean <- allFail.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

allFail.tier2_large_1q <- allFail.tier2_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

allFail.tier2_large_min <- allFail.tier1_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# allFail.tier 1 small
allFail.tier2_small_median <- allFail.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

allFail.tier2_small_mean <- allFail.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

allFail.tier2_small_1q <- allFail.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

allFail.tier2_small_min <- allFail.tier2_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

## allFail.tier 3 and 4 ##
# allFail.tier 3 large
allFail.tier3.4_large_median <- allFail.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

allFail.tier3.4_large_mean <- allFail.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

allFail.tier3.4_large_1q <- allFail.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25))

allFail.tier3.4_large_min <- allFail.tier3.4_large %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))

# allFail.tier 3 small
allFail.tier3.4_small_median <- allFail.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = median(dose_new))

allFail.tier3.4_small_mean <- allFail.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = mean(dose_new))

allFail.tier3.4_small_1q <- allFail.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = quantile(dose_new, 0.25), na.rm = TRUE)

allFail.tier3.4_small_min <- allFail.tier3.4_small %>% 
  group_by(Species, Group) %>% 
  summarize(Conc = min(dose_new))
```

# SSD Build (Tech and Risk Tier Pass)
## Tier 1
### Large (10 - 5000 um) (10 - 5000 um)
#### Tier1_large_median

```{r include=FALSE}
###### --modelling ####
dists_tier1_large_median <- ssd_fit_dists(tier1_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_large_median) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_large_median <- as.data.frame(ssd_gof(dists_tier1_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_large_median <- predict(dists_tier1_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_large_median <- tier1_large_median[order(tier1_large_median$Conc), ]
SSD_tier1_large_median$frac <- ppoints(tier1_large_median$Conc, 0.5)

tier1_large_median_hc5 <- c(pred_tier1_large_median$est[5])
pred_tier1_large_median$est_format <-format(pred_tier1_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
tier1_large_median_ggplot <- ggplot(pred_tier1_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier1_large_median_ggplot
```

#### tier1_large_mean

```{r include=FALSE}
###### --modelling ####
dists_tier1_large_mean <- ssd_fit_dists(tier1_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_large_mean) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_large_mean <- as.data.frame(ssd_gof(dists_tier1_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_large_mean <- predict(dists_tier1_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_large_mean <- tier1_large_mean[order(tier1_large_mean$Conc), ]
SSD_tier1_large_mean$frac <- ppoints(tier1_large_mean$Conc, 0.5)

tier1_large_mean_hc5 <- c(pred_tier1_large_mean$est[5])
pred_tier1_large_mean$est_format <-format(pred_tier1_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
tier1_large_mean_ggplot <- ggplot(pred_tier1_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier1_large_mean_ggplot
```

#### tier1_large_1q
```{r include=FALSE}
###### --modelling ####
dists_tier1_large_1q <- ssd_fit_dists(tier1_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_large_1q) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_large_1q <- as.data.frame(ssd_gof(dists_tier1_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_large_1q <- predict(dists_tier1_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_large_1q <- tier1_large_1q[order(tier1_large_1q$Conc), ]
SSD_tier1_large_1q$frac <- ppoints(tier1_large_1q$Conc, 0.5)

tier1_large_1q_hc5 <- c(pred_tier1_large_1q$est[5])
pred_tier1_large_1q$est_format <-format(pred_tier1_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
tier1_large_1q_ggplot <- ggplot(pred_tier1_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier1_large_1q_ggplot
```

#### tier1_large_min
```{r include=FALSE}
###### --modelling ####
dists_tier1_large_min <- ssd_fit_dists(tier1_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_large_min) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_large_min <- as.data.frame(ssd_gof(dists_tier1_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_large_min <- predict(dists_tier1_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_large_min <- tier1_large_min[order(tier1_large_min$Conc), ]
SSD_tier1_large_min$frac <- ppoints(tier1_large_min$Conc, 0.5)

tier1_large_min_hc5 <- c(pred_tier1_large_min$est[5])
pred_tier1_large_min$est_format <-format(pred_tier1_large_min$est, digits = 3, scientific = TRUE)

#ggplot
tier1_large_min_ggplot <- ggplot(pred_tier1_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier1_large_min_ggplot
```

### Small (1-10 um) 
#### Tier1_small_median

```{r include=FALSE}
###### --modelling ####
dists_tier1_small_median <- ssd_fit_dists(tier1_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_small_median) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_small_median <- as.data.frame(ssd_gof(dists_tier1_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_small_median <- predict(dists_tier1_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_small_median <- tier1_small_median[order(tier1_small_median$Conc), ]
SSD_tier1_small_median$frac <- ppoints(tier1_small_median$Conc, 0.5)

tier1_small_median_hc5 <- c(pred_tier1_small_median$est[5])
pred_tier1_small_median$est_format <-format(pred_tier1_small_median$est, digits = 3, scientific = TRUE)

#ggplot
tier1_small_median_ggplot <- ggplot(pred_tier1_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier1_small_median_ggplot
```

#### tier1_small_mean

```{r include=FALSE}
###### --modelling ####
dists_tier1_small_mean <- ssd_fit_dists(tier1_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_small_mean) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_small_mean <- as.data.frame(ssd_gof(dists_tier1_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_small_mean <- predict(dists_tier1_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_small_mean <- tier1_small_mean[order(tier1_small_mean$Conc), ]
SSD_tier1_small_mean$frac <- ppoints(tier1_small_mean$Conc, 0.5)

tier1_small_mean_hc5 <- c(pred_tier1_small_mean$est[5])
pred_tier1_small_mean$est_format <-format(pred_tier1_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
tier1_small_mean_ggplot <- ggplot(pred_tier1_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier1_small_mean_ggplot
```

#### tier1_small_1q
```{r include=FALSE}
###### --modelling ####
dists_tier1_small_1q <- ssd_fit_dists(tier1_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_small_1q) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_small_1q <- as.data.frame(ssd_gof(dists_tier1_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_small_1q <- predict(dists_tier1_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_small_1q <- tier1_small_1q[order(tier1_small_1q$Conc), ]
SSD_tier1_small_1q$frac <- ppoints(tier1_small_1q$Conc, 0.5)

tier1_small_1q_hc5 <- c(pred_tier1_small_1q$est[5])
pred_tier1_small_1q$est_format <-format(pred_tier1_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
tier1_small_1q_ggplot <- ggplot(pred_tier1_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier1_small_1q_ggplot
```

#### tier1_small_min
```{r include=FALSE}
###### --modelling ####
dists_tier1_small_min <- ssd_fit_dists(tier1_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier1_small_min) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier1_small_min <- as.data.frame(ssd_gof(dists_tier1_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier1_small_min <- predict(dists_tier1_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier1_small_min <- tier1_small_min[order(tier1_small_min$Conc), ]
SSD_tier1_small_min$frac <- ppoints(tier1_small_min$Conc, 0.5)

tier1_small_min_hc5 <- c(pred_tier1_small_min$est[5])
pred_tier1_small_min$est_format <-format(pred_tier1_small_min$est, digits = 3, scientific = TRUE)

#ggplot
tier1_small_min_ggplot <- ggplot(pred_tier1_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier1_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier1_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier1_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier1_small_min_ggplot
```

## tier 2
### Large (10 - 5000 um) 
#### tier2_large_median

```{r include=FALSE}
###### --modelling ####
dists_tier2_large_median <- ssd_fit_dists(tier2_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_large_median) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_large_median <- as.data.frame(ssd_gof(dists_tier2_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_large_median <- predict(dists_tier2_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_large_median <- tier2_large_median[order(tier2_large_median$Conc), ]
SSD_tier2_large_median$frac <- ppoints(tier2_large_median$Conc, 0.5)

tier2_large_median_hc5 <- c(pred_tier2_large_median$est[5])
pred_tier2_large_median$est_format <-format(pred_tier2_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
tier2_large_median_ggplot <- ggplot(pred_tier2_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier2_large_median_ggplot
```

#### tier2_large_mean

```{r include=FALSE}
###### --modelling ####
dists_tier2_large_mean <- ssd_fit_dists(tier2_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_large_mean) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_large_mean <- as.data.frame(ssd_gof(dists_tier2_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_large_mean <- predict(dists_tier2_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_large_mean <- tier2_large_mean[order(tier2_large_mean$Conc), ]
SSD_tier2_large_mean$frac <- ppoints(tier2_large_mean$Conc, 0.5)

tier2_large_mean_hc5 <- c(pred_tier2_large_mean$est[5])
pred_tier2_large_mean$est_format <-format(pred_tier2_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
tier2_large_mean_ggplot <- ggplot(pred_tier2_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier2_large_mean_ggplot
```

#### tier2_large_1q
```{r include=FALSE}
###### --modelling ####
dists_tier2_large_1q <- ssd_fit_dists(tier2_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_large_1q) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_large_1q <- as.data.frame(ssd_gof(dists_tier2_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_large_1q <- predict(dists_tier2_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_large_1q <- tier2_large_1q[order(tier2_large_1q$Conc), ]
SSD_tier2_large_1q$frac <- ppoints(tier2_large_1q$Conc, 0.5)

tier2_large_1q_hc5 <- c(pred_tier2_large_1q$est[5])
pred_tier2_large_1q$est_format <-format(pred_tier2_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
tier2_large_1q_ggplot <- ggplot(pred_tier2_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier2_large_1q_ggplot
```

#### tier2_large_min
```{r include=FALSE}
###### --modelling ####
dists_tier2_large_min <- ssd_fit_dists(tier2_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_large_min) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_large_min <- as.data.frame(ssd_gof(dists_tier2_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_large_min <- predict(dists_tier2_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_large_min <- tier2_large_min[order(tier2_large_min$Conc), ]
SSD_tier2_large_min$frac <- ppoints(tier2_large_min$Conc, 0.5)

tier2_large_min_hc5 <- c(pred_tier2_large_min$est[5])
pred_tier2_large_min$est_format <-format(pred_tier2_large_min$est, digits = 3, scientific = TRUE)

#ggplot
tier2_large_min_ggplot <- ggplot(pred_tier2_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier2_large_min_ggplot
```
### Small (1-10 um) 
#### tier2_small_median

```{r include=FALSE}
###### --modelling ####
dists_tier2_small_median <- ssd_fit_dists(tier2_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_small_median) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_small_median <- as.data.frame(ssd_gof(dists_tier2_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_small_median <- predict(dists_tier2_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_small_median <- tier2_small_median[order(tier2_small_median$Conc), ]
SSD_tier2_small_median$frac <- ppoints(tier2_small_median$Conc, 0.5)

tier2_small_median_hc5 <- c(pred_tier2_small_median$est[5])
pred_tier2_small_median$est_format <-format(pred_tier2_small_median$est, digits = 3, scientific = TRUE)

#ggplot
tier2_small_median_ggplot <- ggplot(pred_tier2_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier2_small_median_ggplot
```

#### tier2_small_mean

```{r include=FALSE}
###### --modelling ####
dists_tier2_small_mean <- ssd_fit_dists(tier2_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_small_mean) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_small_mean <- as.data.frame(ssd_gof(dists_tier2_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_small_mean <- predict(dists_tier2_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_small_mean <- tier2_small_mean[order(tier2_small_mean$Conc), ]
SSD_tier2_small_mean$frac <- ppoints(tier2_small_mean$Conc, 0.5)

tier2_small_mean_hc5 <- c(pred_tier2_small_mean$est[5])
pred_tier2_small_mean$est_format <-format(pred_tier2_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
tier2_small_mean_ggplot <- ggplot(pred_tier2_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier2_small_mean_ggplot
```

#### tier2_small_1q
```{r include=FALSE}
###### --modelling ####
dists_tier2_small_1q <- ssd_fit_dists(tier2_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_small_1q) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_small_1q <- as.data.frame(ssd_gof(dists_tier2_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_small_1q <- predict(dists_tier2_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_small_1q <- tier2_small_1q[order(tier2_small_1q$Conc), ]
SSD_tier2_small_1q$frac <- ppoints(tier2_small_1q$Conc, 0.5)

tier2_small_1q_hc5 <- c(pred_tier2_small_1q$est[5])
pred_tier2_small_1q$est_format <-format(pred_tier2_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
tier2_small_1q_ggplot <- ggplot(pred_tier2_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier2_small_1q_ggplot
```

#### tier2_small_min
```{r include=FALSE}
###### --modelling ####
dists_tier2_small_min <- ssd_fit_dists(tier2_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier2_small_min) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier2_small_min <- as.data.frame(ssd_gof(dists_tier2_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier2_small_min <- predict(dists_tier2_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier2_small_min <- tier2_small_min[order(tier2_small_min$Conc), ]
SSD_tier2_small_min$frac <- ppoints(tier2_small_min$Conc, 0.5)

tier2_small_min_hc5 <- c(pred_tier2_small_min$est[5])
pred_tier2_small_min$est_format <-format(pred_tier2_small_min$est, digits = 3, scientific = TRUE)

#ggplot
tier2_small_min_ggplot <- ggplot(pred_tier2_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier2_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier2_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier2_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier2_small_min_ggplot
```

## Tier 3
### Large (10 - 5000 um) 
#### tier3.4_large_median

```{r include=FALSE}
###### --modelling ####
dists_tier3.4_large_median <- ssd_fit_dists(tier3.4_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_large_median) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_large_median <- as.data.frame(ssd_gof(dists_tier3.4_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_large_median <- predict(dists_tier3.4_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_large_median <- tier3.4_large_median[order(tier3.4_large_median$Conc), ]
SSD_tier3.4_large_median$frac <- ppoints(tier3.4_large_median$Conc, 0.5)

tier3.4_large_median_hc5 <- c(pred_tier3.4_large_median$est[5])
#extrac hc10 (tier 4)
tier3.4_large_median_hc10 <- c(pred_tier3.4_large_median$est[10])
pred_tier3.4_large_median$est_format <-format(pred_tier3.4_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
tier3.4_large_median_ggplot <- ggplot(pred_tier3.4_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier3.4_large_median_ggplot
```

#### tier3.4_large_mean

```{r include=FALSE}
###### --modelling ####
dists_tier3.4_large_mean <- ssd_fit_dists(tier3.4_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_large_mean) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_large_mean <- as.data.frame(ssd_gof(dists_tier3.4_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_large_mean <- predict(dists_tier3.4_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_large_mean <- tier3.4_large_mean[order(tier3.4_large_mean$Conc), ]
SSD_tier3.4_large_mean$frac <- ppoints(tier3.4_large_mean$Conc, 0.5)

tier3.4_large_mean_hc5 <- c(pred_tier3.4_large_mean$est[5])
#extrac hc10 (tier 4)
tier3.4_large_mean_hc10 <- c(pred_tier3.4_large_mean$est[10])

pred_tier3.4_large_mean$est_format <-format(pred_tier3.4_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
tier3.4_large_mean_ggplot <- ggplot(pred_tier3.4_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier3.4_large_mean_ggplot
```

#### tier3.4_large_1q
```{r include=FALSE}
###### --modelling ####
dists_tier3.4_large_1q <- ssd_fit_dists(tier3.4_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_large_1q) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_large_1q <- as.data.frame(ssd_gof(dists_tier3.4_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_large_1q <- predict(dists_tier3.4_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_large_1q <- tier3.4_large_1q[order(tier3.4_large_1q$Conc), ]
SSD_tier3.4_large_1q$frac <- ppoints(tier3.4_large_1q$Conc, 0.5)

tier3.4_large_1q_hc5 <- c(pred_tier3.4_large_1q$est[5])
#extrac hc10 (tier 4)
tier3.4_large_1q_hc10 <- c(pred_tier3.4_large_1q$est[10])
pred_tier3.4_large_1q$est_format <-format(pred_tier3.4_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
tier3.4_large_1q_ggplot <- ggplot(pred_tier3.4_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier3.4_large_1q_ggplot
```

#### tier3.4_large_min
```{r include=FALSE}
###### --modelling ####
dists_tier3.4_large_min <- ssd_fit_dists(tier3.4_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_large_min) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_large_min <- as.data.frame(ssd_gof(dists_tier3.4_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_large_min <- predict(dists_tier3.4_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_large_min <- tier3.4_large_min[order(tier3.4_large_min$Conc), ]
SSD_tier3.4_large_min$frac <- ppoints(tier3.4_large_min$Conc, 0.5)

tier3.4_large_min_hc5 <- c(pred_tier3.4_large_min$est[5])
#extrac hc10 (tier 4)
tier3.4_large_min_hc10 <- c(pred_tier3.4_large_min$est[10])
pred_tier3.4_large_min$est_format <-format(pred_tier3.4_large_min$est, digits = 3, scientific = TRUE)

#ggplot
tier3.4_large_min_ggplot <- ggplot(pred_tier3.4_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier3.4_large_min_ggplot
```

### Small (1-10 um) 
#### tier3.4_small_median

```{r include=FALSE}
###### --modelling ####
dists_tier3.4_small_median <- ssd_fit_dists(tier3.4_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_small_median) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_small_median <- as.data.frame(ssd_gof(dists_tier3.4_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_small_median <- predict(dists_tier3.4_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_small_median <- tier3.4_small_median[order(tier3.4_small_median$Conc), ]
SSD_tier3.4_small_median$frac <- ppoints(tier3.4_small_median$Conc, 0.5)

tier3.4_small_median_hc5 <- c(pred_tier3.4_small_median$est[5])
#extrac hc10 (tier 4)
tier3.4_small_median_hc10 <- c(pred_tier3.4_small_median$est[10])

pred_tier3.4_small_median$est_format <-format(pred_tier3.4_small_median$est, digits = 3, scientific = TRUE)

#ggplot
tier3.4_small_median_ggplot <- ggplot(pred_tier3.4_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier3.4_small_median_ggplot
```

#### tier3.4_small_mean

```{r include=FALSE}
###### --modelling ####
dists_tier3.4_small_mean <- ssd_fit_dists(tier3.4_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_small_mean) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_small_mean <- as.data.frame(ssd_gof(dists_tier3.4_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_small_mean <- predict(dists_tier3.4_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_small_mean <- tier3.4_small_mean[order(tier3.4_small_mean$Conc), ]
SSD_tier3.4_small_mean$frac <- ppoints(tier3.4_small_mean$Conc, 0.5)

tier3.4_small_mean_hc5 <- c(pred_tier3.4_small_mean$est[5])
#extrac hc10 (tier 4)
tier3.4_small_mean_hc10 <- c(pred_tier3.4_small_mean$est[10])

pred_tier3.4_small_mean$est_format <-format(pred_tier3.4_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
tier3.4_small_mean_ggplot <- ggplot(pred_tier3.4_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tier3.4_small_mean_ggplot
```

#### tier3.4_small_1q
```{r include=FALSE}
###### --modelling ####
dists_tier3.4_small_1q <- ssd_fit_dists(tier3.4_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_small_1q) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_small_1q <- as.data.frame(ssd_gof(dists_tier3.4_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_small_1q <- predict(dists_tier3.4_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_small_1q <- tier3.4_small_1q[order(tier3.4_small_1q$Conc), ]
SSD_tier3.4_small_1q$frac <- ppoints(tier3.4_small_1q$Conc, 0.5)

tier3.4_small_1q_hc5 <- c(pred_tier3.4_small_1q$est[5])
#extrac hc10 (tier 4)
tier3.4_small_1q_hc10 <- c(pred_tier3.4_small_1q$est[10])

pred_tier3.4_small_1q$est_format <-format(pred_tier3.4_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
tier3.4_small_1q_ggplot <- ggplot(pred_tier3.4_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier3.4_small_1q_ggplot
```

#### tier3.4_small_min
```{r include=FALSE}
###### --modelling ####
dists_tier3.4_small_min <- ssd_fit_dists(tier3.4_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tier3.4_small_min) #plots the distribution in ggplotier2
#### Goodness of fit ####
gof_tier3.4_small_min <- as.data.frame(ssd_gof(dists_tier3.4_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tier3.4_small_min <- predict(dists_tier3.4_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tier3.4_small_min <- tier3.4_small_min[order(tier3.4_small_min$Conc), ]
SSD_tier3.4_small_min$frac <- ppoints(tier3.4_small_min$Conc, 0.5)

#extract hc5
tier3.4_small_min_hc5 <- c(pred_tier3.4_small_min$est[5])

#extrac hc10 (tier 4)
tier3.4_small_min_hc10 <- c(pred_tier3.4_small_min$est[10])
pred_tier3.4_small_min$est_format <-format(pred_tier3.4_small_min$est, digits = 3, scientific = TRUE)

#ggplot
tier3.4_small_min_ggplot <- ggplot(pred_tier3.4_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tier3.4_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tier3.4_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tier3.4_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tier3.4_small_min_ggplot
```

# Combine plots
## Tier 1
### Small (1-10 um)s
```{r}
### tier1_small_median
ggplot(pred_tier1_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tier1_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tier1_small_mean ###
  geom_xribbon(data = pred_tier1_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tier1_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tier1_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tier1_small_1q ###
    geom_xribbon(data = pred_tier1_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tier1_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tier1_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
### fourth line: tier1_small_min ###
    geom_xribbon(data = pred_tier1_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tier1_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tier1_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (Tier 1)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### tier1_large_median
ggplot(pred_tier1_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tier1_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tier1_large_mean ###
  geom_xribbon(data = pred_tier1_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tier1_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tier1_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tier1_large_1q ###
    geom_xribbon(data = pred_tier1_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tier1_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tier1_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
  ### fourth line: tier1_large_min ###
    geom_xribbon(data = pred_tier1_large_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tier1_large_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tier1_large_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (Tier 1)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## Tier 2
### Small (1-10 um)s
```{r}
### tier2_small_median
ggplot(pred_tier2_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tier2_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tier2_small_mean ###
  geom_xribbon(data = pred_tier2_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tier2_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tier2_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tier2_small_1q ###
    geom_xribbon(data = pred_tier2_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tier2_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tier2_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  ### fourth line: tier2_small_min  ###
    geom_xribbon(data = pred_tier2_small_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tier2_small_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tier2_small_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
  ### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (Tier 2)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### tier2_large_median
ggplot(pred_tier2_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tier2_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tier2_large_mean ###
  geom_xribbon(data = pred_tier2_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tier2_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tier2_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tier2_large_1q  ###
    geom_xribbon(data = pred_tier2_large_1q , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tier2_large_1q , aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tier2_large_1q , aes(x = Conc, y =frac), 
                 color = "green") +  
  
    ### fourth line: tier2_large_min  ###
    geom_xribbon(data = pred_tier2_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tier2_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tier2_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (Tier 2)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## Tier 3/4
### Small (1-10 um)s
```{r}
### tier3.4_small_median
ggplot(pred_tier3.4_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tier3.4_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tier3.4_small_mean ###
  geom_xribbon(data = pred_tier3.4_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tier3.4_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tier3.4_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tier3.4_small_1q ###
    geom_xribbon(data = pred_tier3.4_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tier3.4_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tier3.4_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: tier3.4_small_min ###
    geom_xribbon(data = pred_tier3.4_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tier3.4_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tier3.4_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") + 
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (Tier 3/4)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = min"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### tier3.4_large_median
ggplot(pred_tier3.4_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tier3.4_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tier3.4_large_mean ###
  geom_xribbon(data = pred_tier3.4_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tier3.4_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tier3.4_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tier3.4_large_1q ###
    geom_xribbon(data = pred_tier3.4_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tier3.4_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tier3.4_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: tier3.4_large_min  ###
    geom_xribbon(data = pred_tier3.4_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tier3.4_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tier3.4_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (Tier 3/4)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## Summary Table

```{r}
# Small/Large x tier 1/2/3 x median/mean/q1 = 2 x 3 x 3 = 18 comparisons
larges <- list(tier1_large_median_hc5, tier1_large_mean_hc5, tier1_large_1q_hc5, tier1_large_min_hc5,
              tier1_large.obs[[1,1]], #n.obs
              tier1_large.obs[[1,2]], #n.studies
              tier1_large.obs[[1,3]], #n.taxa
              tier1_large.obs[[1,4]], #n.species
          #tier 2
          tier2_large_median_hc5, tier2_large_mean_hc5, tier2_large_1q_hc5, tier2_large_min_hc5,
          tier2_large.obs[[1,1]], #n.obs
          tier2_large.obs[[1,2]], #n.studies
          tier2_large.obs[[1,3]], #n.taxa
          tier2_large.obs[[1,4]], #n.species
          #tier 3 (hc5)
          tier3.4_large_median_hc5, tier3.4_large_mean_hc5, tier3.4_large_1q_hc5, tier3.4_large_min_hc5,
          tier3.4_large.obs[[1,1]], #n.obs
          tier3.4_large.obs[[1,2]], #n.studies
          tier3.4_large.obs[[1,3]], #n.taxa
          tier3.4_large.obs[[1,4]], #n.species
          #tier 4 (hc10)
          tier3.4_large_median_hc10, tier3.4_large_mean_hc10, tier3.4_large_1q_hc10, tier3.4_large_min_hc10,
          tier3.4_large.obs[[1,1]], #n.obs
          tier3.4_large.obs[[1,2]], #n.studies
          tier3.4_large.obs[[1,3]], #n.taxa
          tier3.4_large.obs[[1,4]] #n.species
          )

smalls <- list(tier1_small_median_hc5, tier1_small_mean_hc5, tier1_small_1q_hc5, tier1_small_min_hc5,
               tier1_small.obs[[1,1]], #n.obs
               tier1_small.obs[[1,2]], #n.studies
               tier1_small.obs[[1,3]], #n.taxa
               tier1_small.obs[[1,4]], #n.species
          #tier 2
          tier2_small_median_hc5, tier2_small_mean_hc5, tier2_small_1q_hc5, tier2_small_min_hc5,
          tier2_small.obs[[1,1]], #n.obs
          tier2_small.obs[[1,2]], #n.studies
          tier2_small.obs[[1,3]], #n.taxa
          tier2_small.obs[[1,4]], #n.species
          #tier 3 (hc5)
          tier3.4_small_median_hc5, tier3.4_small_mean_hc5, tier3.4_small_1q_hc5, tier3.4_small_min_hc5,
          tier3.4_small.obs[[1,1]], #n.obs
          tier3.4_small.obs[[1,2]], #n.studies
          tier3.4_small.obs[[1,3]], #n.taxa
          tier3.4_small.obs[[1,4]], #n.specie
          #tier 4 (hc10)
          tier3.4_small_median_hc10, tier3.4_small_mean_hc10, tier3.4_small_1q_hc10, tier3.4_small_min_hc10,
          tier3.4_small.obs[[1,1]], #n.obs
          tier3.4_small.obs[[1,2]], #n.studies
          tier3.4_small.obs[[1,3]], #n.taxa
          tier3.4_small.obs[[1,4]] #n.specie
          )

## Conver to data frames
largesdf <- data.frame(t(matrix(unlist(larges), ncol = 4)))
smallsdf <- data.frame(t(matrix(unlist(smalls), ncol = 4))) #t = transpose

# convert mg/L to ug/L
largesdf <- largesdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

smallsdf <- smallsdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

# rename columns and rows
colnames(largesdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")
colnames(smallsdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")

rownames(largesdf) <- c("Tier 1", "Tier 2", "Tier 3", "Tier 4")
rownames(smallsdf) <- c("Tier 1", "Tier 2", "Tier 3", "Tier 4")

# provide tier column
largestibble <- tibble(largesdf,
                       Tier = rownames(largesdf))

#re-arrange columns
largestibble <- largestibble[c("Tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

# provide tier column
smallstibble <- tibble(smallsdf,
                       Tier = rownames(smallsdf))

#re-arrange columns
smallstibble <- smallstibble[c("Tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

#function to create tables
hp_table <- function(x){
  #get full value range for whole table conditional formatting
  full_val_range <- x %>% 
    ungroup %>% 
    select_if(is.numeric) %>% 
    range
  
  #format colors accordingly
  gt(x) %>% 
    fmt_number(columns = vars(Mean, Median, Quartile_1, Minimum),
             n_sigfig = 2,
             use_seps = TRUE) %>% 
    data_color(
    columns = names(x)[2:5],
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(palette = "ggsci::teal_material") %>% as.character(),
      domain = full_val_range),
    alpha = 0.75) %>% 
    tab_options(column_labels.hidden = FALSE) %>% 
    as_raw_html() # return as html
}

#larges gt
larges_gt <- largestibble %>% 
  hp_table()

#smalls gt
smalls_gt <- smallstibble %>% 
  hp_table() 
  
## Combine
data.tables <- data.frame(smalls_table = smalls_gt,
                          larges_table = larges_gt)
#Combine
allPass.summary <- data.tables %>% 
  gt() %>% 
  fmt_markdown(columns = TRUE) %>% 
  cols_label(smalls_table = "1-10 um",
             larges_table = "10-5,000 um") %>% 
  tab_source_note(md("Calculated from SSDs")) %>% 
  tab_header(title = paste("Microplastics HC5", particle_mass_check_ssd, "by Data Collapse and Tier"),
             subtitle = "Qualiter Filters: Risk and Tech Tier") 

allPass.summary
```

# SSD Build (Risk Tier Pass, Tech Tier Fail)
## risk.pass.tier 1
### Large (10 - 5000 um) 
#### risk.pass.tier1_large_median

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_large_median <- ssd_fit_dists(risk.pass.tier1_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_large_median) #plots the distribution in ggplorisk.pass.risk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_large_median <- as.data.frame(ssd_gof(dists_risk.pass.tier1_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_large_median <- predict(dists_risk.pass.tier1_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_large_median <- risk.pass.tier1_large_median[order(risk.pass.tier1_large_median$Conc), ]
SSD_risk.pass.tier1_large_median$frac <- ppoints(risk.pass.tier1_large_median$Conc, 0.5)

risk.pass.tier1_large_median_hc5 <- c(pred_risk.pass.tier1_large_median$est[5])
pred_risk.pass.tier1_large_median$est_format <-format(pred_risk.pass.tier1_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
risk.pass.tier1_large_median_ggplot <- ggplot(pred_risk.pass.tier1_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier1_large_median_ggplot
```

#### risk.pass.tier1_large_mean

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_large_mean <- ssd_fit_dists(risk.pass.tier1_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_large_mean) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_large_mean <- as.data.frame(ssd_gof(dists_risk.pass.tier1_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_large_mean <- predict(dists_risk.pass.tier1_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_large_mean <- risk.pass.tier1_large_mean[order(risk.pass.tier1_large_mean$Conc), ]
SSD_risk.pass.tier1_large_mean$frac <- ppoints(risk.pass.tier1_large_mean$Conc, 0.5)

risk.pass.tier1_large_mean_hc5 <- c(pred_risk.pass.tier1_large_mean$est[5])
pred_risk.pass.tier1_large_mean$est_format <-format(pred_risk.pass.tier1_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
risk.pass.tier1_large_mean_ggplot <- ggplot(pred_risk.pass.tier1_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier1_large_mean_ggplot
```

#### risk.pass.tier1_large_1q
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_large_1q <- ssd_fit_dists(risk.pass.tier1_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_large_1q) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_large_1q <- as.data.frame(ssd_gof(dists_risk.pass.tier1_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_large_1q <- predict(dists_risk.pass.tier1_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_large_1q <- risk.pass.tier1_large_1q[order(risk.pass.tier1_large_1q$Conc), ]
SSD_risk.pass.tier1_large_1q$frac <- ppoints(risk.pass.tier1_large_1q$Conc, 0.5)

risk.pass.tier1_large_1q_hc5 <- c(pred_risk.pass.tier1_large_1q$est[5])
pred_risk.pass.tier1_large_1q$est_format <-format(pred_risk.pass.tier1_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier1_large_1q_ggplot <- ggplot(pred_risk.pass.tier1_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier1_large_1q_ggplot
```

#### risk.pass.tier1_large_min
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_large_min <- ssd_fit_dists(risk.pass.tier1_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_large_min) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_large_min <- as.data.frame(ssd_gof(dists_risk.pass.tier1_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_large_min <- predict(dists_risk.pass.tier1_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_large_min <- risk.pass.tier1_large_min[order(risk.pass.tier1_large_min$Conc), ]
SSD_risk.pass.tier1_large_min$frac <- ppoints(risk.pass.tier1_large_min$Conc, 0.5)

risk.pass.tier1_large_min_hc5 <- c(pred_risk.pass.tier1_large_min$est[5])
pred_risk.pass.tier1_large_min$est_format <-format(pred_risk.pass.tier1_large_min$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier1_large_min_ggplot <- ggplot(pred_risk.pass.tier1_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier1_large_min_ggplot
```

### Small (1-10 um) 
#### risk.pass.tier1_small_median

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_small_median <- ssd_fit_dists(risk.pass.tier1_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_small_median) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_small_median <- as.data.frame(ssd_gof(dists_risk.pass.tier1_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_small_median <- predict(dists_risk.pass.tier1_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_small_median <- risk.pass.tier1_small_median[order(risk.pass.tier1_small_median$Conc), ]
SSD_risk.pass.tier1_small_median$frac <- ppoints(risk.pass.tier1_small_median$Conc, 0.5)

risk.pass.tier1_small_median_hc5 <- c(pred_risk.pass.tier1_small_median$est[5])
pred_risk.pass.tier1_small_median$est_format <-format(pred_risk.pass.tier1_small_median$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier1_small_median_ggplot <- ggplot(pred_risk.pass.tier1_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier1_small_median_ggplot
```

#### risk.pass.tier1_small_mean

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_small_mean <- ssd_fit_dists(risk.pass.tier1_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_small_mean) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_small_mean <- as.data.frame(ssd_gof(dists_risk.pass.tier1_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_small_mean <- predict(dists_risk.pass.tier1_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_small_mean <- risk.pass.tier1_small_mean[order(risk.pass.tier1_small_mean$Conc), ]
SSD_risk.pass.tier1_small_mean$frac <- ppoints(risk.pass.tier1_small_mean$Conc, 0.5)

risk.pass.tier1_small_mean_hc5 <- c(pred_risk.pass.tier1_small_mean$est[5])
pred_risk.pass.tier1_small_mean$est_format <-format(pred_risk.pass.tier1_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
risk.pass.tier1_small_mean_ggplot <- ggplot(pred_risk.pass.tier1_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier1_small_mean_ggplot
```

#### risk.pass.tier1_small_1q
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_small_1q <- ssd_fit_dists(risk.pass.tier1_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_small_1q) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_small_1q <- as.data.frame(ssd_gof(dists_risk.pass.tier1_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_small_1q <- predict(dists_risk.pass.tier1_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_small_1q <- risk.pass.tier1_small_1q[order(risk.pass.tier1_small_1q$Conc), ]
SSD_risk.pass.tier1_small_1q$frac <- ppoints(risk.pass.tier1_small_1q$Conc, 0.5)

risk.pass.tier1_small_1q_hc5 <- c(pred_risk.pass.tier1_small_1q$est[5])
pred_risk.pass.tier1_small_1q$est_format <-format(pred_risk.pass.tier1_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier1_small_1q_ggplot <- ggplot(pred_risk.pass.tier1_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier1_small_1q_ggplot
```

#### risk.pass.tier1_small_min
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier1_small_min <- ssd_fit_dists(risk.pass.tier1_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier1_small_min) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier1_small_min <- as.data.frame(ssd_gof(dists_risk.pass.tier1_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier1_small_min <- predict(dists_risk.pass.tier1_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier1_small_min <- risk.pass.tier1_small_min[order(risk.pass.tier1_small_min$Conc), ]
SSD_risk.pass.tier1_small_min$frac <- ppoints(risk.pass.tier1_small_min$Conc, 0.5)

risk.pass.tier1_small_min_hc5 <- c(pred_risk.pass.tier1_small_min$est[5])
pred_risk.pass.tier1_small_min$est_format <-format(pred_risk.pass.tier1_small_min$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier1_small_min_ggplot <- ggplot(pred_risk.pass.tier1_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier1_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier1_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier1_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier1_small_min_ggplot
```

## risk.pass.tier 2
### Large (10 - 5000 um) 
#### risk.pass.tier2_large_median

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_large_median <- ssd_fit_dists(risk.pass.tier2_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_large_median) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_large_median <- as.data.frame(ssd_gof(dists_risk.pass.tier2_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_large_median <- predict(dists_risk.pass.tier2_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_large_median <- risk.pass.tier2_large_median[order(risk.pass.tier2_large_median$Conc), ]
SSD_risk.pass.tier2_large_median$frac <- ppoints(risk.pass.tier2_large_median$Conc, 0.5)

risk.pass.tier2_large_median_hc5 <- c(pred_risk.pass.tier2_large_median$est[5])
pred_risk.pass.tier2_large_median$est_format <-format(pred_risk.pass.tier2_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
risk.pass.tier2_large_median_ggplot <- ggplot(pred_risk.pass.tier2_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier2_large_median_ggplot
```

#### risk.pass.tier2_large_mean

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_large_mean <- ssd_fit_dists(risk.pass.tier2_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_large_mean) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_large_mean <- as.data.frame(ssd_gof(dists_risk.pass.tier2_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_large_mean <- predict(dists_risk.pass.tier2_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_large_mean <- risk.pass.tier2_large_mean[order(risk.pass.tier2_large_mean$Conc), ]
SSD_risk.pass.tier2_large_mean$frac <- ppoints(risk.pass.tier2_large_mean$Conc, 0.5)

risk.pass.tier2_large_mean_hc5 <- c(pred_risk.pass.tier2_large_mean$est[5])
pred_risk.pass.tier2_large_mean$est_format <-format(pred_risk.pass.tier2_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
risk.pass.tier2_large_mean_ggplot <- ggplot(pred_risk.pass.tier2_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier2_large_mean_ggplot
```

#### risk.pass.tier2_large_1q
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_large_1q <- ssd_fit_dists(risk.pass.tier2_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_large_1q) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_large_1q <- as.data.frame(ssd_gof(dists_risk.pass.tier2_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_large_1q <- predict(dists_risk.pass.tier2_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_large_1q <- risk.pass.tier2_large_1q[order(risk.pass.tier2_large_1q$Conc), ]
SSD_risk.pass.tier2_large_1q$frac <- ppoints(risk.pass.tier2_large_1q$Conc, 0.5)

risk.pass.tier2_large_1q_hc5 <- c(pred_risk.pass.tier2_large_1q$est[5])
pred_risk.pass.tier2_large_1q$est_format <-format(pred_risk.pass.tier2_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier2_large_1q_ggplot <- ggplot(pred_risk.pass.tier2_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier2_large_1q_ggplot
```

#### risk.pass.tier2_large_min
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_large_min <- ssd_fit_dists(risk.pass.tier2_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_large_min) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_large_min <- as.data.frame(ssd_gof(dists_risk.pass.tier2_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_large_min <- predict(dists_risk.pass.tier2_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_large_min <- risk.pass.tier2_large_min[order(risk.pass.tier2_large_min$Conc), ]
SSD_risk.pass.tier2_large_min$frac <- ppoints(risk.pass.tier2_large_min$Conc, 0.5)

risk.pass.tier2_large_min_hc5 <- c(pred_risk.pass.tier2_large_min$est[5])
pred_risk.pass.tier2_large_min$est_format <-format(pred_risk.pass.tier2_large_min$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier2_large_min_ggplot <- ggplot(pred_risk.pass.tier2_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier2_large_min_ggplot
```
### Small (1-10 um) 
#### risk.pass.tier2_small_median

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_small_median <- ssd_fit_dists(risk.pass.tier2_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_small_median) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_small_median <- as.data.frame(ssd_gof(dists_risk.pass.tier2_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_small_median <- predict(dists_risk.pass.tier2_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_small_median <- risk.pass.tier2_small_median[order(risk.pass.tier2_small_median$Conc), ]
SSD_risk.pass.tier2_small_median$frac <- ppoints(risk.pass.tier2_small_median$Conc, 0.5)

risk.pass.tier2_small_median_hc5 <- c(pred_risk.pass.tier2_small_median$est[5])
pred_risk.pass.tier2_small_median$est_format <-format(pred_risk.pass.tier2_small_median$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier2_small_median_ggplot <- ggplot(pred_risk.pass.tier2_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier2_small_median_ggplot
```

#### risk.pass.tier2_small_mean

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_small_mean <- ssd_fit_dists(risk.pass.tier2_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_small_mean) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_small_mean <- as.data.frame(ssd_gof(dists_risk.pass.tier2_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_small_mean <- predict(dists_risk.pass.tier2_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_small_mean <- risk.pass.tier2_small_mean[order(risk.pass.tier2_small_mean$Conc), ]
SSD_risk.pass.tier2_small_mean$frac <- ppoints(risk.pass.tier2_small_mean$Conc, 0.5)

risk.pass.tier2_small_mean_hc5 <- c(pred_risk.pass.tier2_small_mean$est[5])
pred_risk.pass.tier2_small_mean$est_format <-format(pred_risk.pass.tier2_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
risk.pass.tier2_small_mean_ggplot <- ggplot(pred_risk.pass.tier2_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier2_small_mean_ggplot
```

#### risk.pass.tier2_small_1q
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_small_1q <- ssd_fit_dists(risk.pass.tier2_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_small_1q) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_small_1q <- as.data.frame(ssd_gof(dists_risk.pass.tier2_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_small_1q <- predict(dists_risk.pass.tier2_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_small_1q <- risk.pass.tier2_small_1q[order(risk.pass.tier2_small_1q$Conc), ]
SSD_risk.pass.tier2_small_1q$frac <- ppoints(risk.pass.tier2_small_1q$Conc, 0.5)

risk.pass.tier2_small_1q_hc5 <- c(pred_risk.pass.tier2_small_1q$est[5])
pred_risk.pass.tier2_small_1q$est_format <-format(pred_risk.pass.tier2_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier2_small_1q_ggplot <- ggplot(pred_risk.pass.tier2_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier2_small_1q_ggplot
```

#### risk.pass.tier2_small_min
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier2_small_min <- ssd_fit_dists(risk.pass.tier2_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier2_small_min) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier2_small_min <- as.data.frame(ssd_gof(dists_risk.pass.tier2_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier2_small_min <- predict(dists_risk.pass.tier2_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier2_small_min <- risk.pass.tier2_small_min[order(risk.pass.tier2_small_min$Conc), ]
SSD_risk.pass.tier2_small_min$frac <- ppoints(risk.pass.tier2_small_min$Conc, 0.5)

risk.pass.tier2_small_min_hc5 <- c(pred_risk.pass.tier2_small_min$est[5])
pred_risk.pass.tier2_small_min$est_format <-format(pred_risk.pass.tier2_small_min$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier2_small_min_ggplot <- ggplot(pred_risk.pass.tier2_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier2_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier2_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier2_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier2_small_min_ggplot
```

## risk.pass.tier 3
### Large (10 - 5000 um) 
#### risk.pass.tier3.4_large_median

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_large_median <- ssd_fit_dists(risk.pass.tier3.4_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_large_median) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_large_median <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_large_median <- predict(dists_risk.pass.tier3.4_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_large_median <- risk.pass.tier3.4_large_median[order(risk.pass.tier3.4_large_median$Conc), ]
SSD_risk.pass.tier3.4_large_median$frac <- ppoints(risk.pass.tier3.4_large_median$Conc, 0.5)

risk.pass.tier3.4_large_median_hc5 <- c(pred_risk.pass.tier3.4_large_median$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_large_median_hc10 <- c(pred_risk.pass.tier3.4_large_median$est[10])
pred_risk.pass.tier3.4_large_median$est_format <-format(pred_risk.pass.tier3.4_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
risk.pass.tier3.4_large_median_ggplot <- ggplot(pred_risk.pass.tier3.4_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier3.4_large_median_ggplot
```

#### risk.pass.tier3.4_large_mean

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_large_mean <- ssd_fit_dists(risk.pass.tier3.4_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_large_mean) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_large_mean <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_large_mean <- predict(dists_risk.pass.tier3.4_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_large_mean <- risk.pass.tier3.4_large_mean[order(risk.pass.tier3.4_large_mean$Conc), ]
SSD_risk.pass.tier3.4_large_mean$frac <- ppoints(risk.pass.tier3.4_large_mean$Conc, 0.5)

risk.pass.tier3.4_large_mean_hc5 <- c(pred_risk.pass.tier3.4_large_mean$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_large_mean_hc10 <- c(pred_risk.pass.tier3.4_large_mean$est[10])

pred_risk.pass.tier3.4_large_mean$est_format <-format(pred_risk.pass.tier3.4_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
risk.pass.tier3.4_large_mean_ggplot <- ggplot(pred_risk.pass.tier3.4_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier3.4_large_mean_ggplot
```

#### risk.pass.tier3.4_large_1q
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_large_1q <- ssd_fit_dists(risk.pass.tier3.4_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_large_1q) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_large_1q <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_large_1q <- predict(dists_risk.pass.tier3.4_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_large_1q <- risk.pass.tier3.4_large_1q[order(risk.pass.tier3.4_large_1q$Conc), ]
SSD_risk.pass.tier3.4_large_1q$frac <- ppoints(risk.pass.tier3.4_large_1q$Conc, 0.5)

risk.pass.tier3.4_large_1q_hc5 <- c(pred_risk.pass.tier3.4_large_1q$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_large_1q_hc10 <- c(pred_risk.pass.tier3.4_large_1q$est[10])
pred_risk.pass.tier3.4_large_1q$est_format <-format(pred_risk.pass.tier3.4_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier3.4_large_1q_ggplot <- ggplot(pred_risk.pass.tier3.4_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier3.4_large_1q_ggplot
```

#### risk.pass.tier3.4_large_min
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_large_min <- ssd_fit_dists(risk.pass.tier3.4_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_large_min) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_large_min <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_large_min <- predict(dists_risk.pass.tier3.4_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_large_min <- risk.pass.tier3.4_large_min[order(risk.pass.tier3.4_large_min$Conc), ]
SSD_risk.pass.tier3.4_large_min$frac <- ppoints(risk.pass.tier3.4_large_min$Conc, 0.5)

risk.pass.tier3.4_large_min_hc5 <- c(pred_risk.pass.tier3.4_large_min$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_large_min_hc10 <- c(pred_risk.pass.tier3.4_large_min$est[10])
pred_risk.pass.tier3.4_large_min$est_format <-format(pred_risk.pass.tier3.4_large_min$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier3.4_large_min_ggplot <- ggplot(pred_risk.pass.tier3.4_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier3.4_large_min_ggplot
```

### Small (1-10 um) 
#### risk.pass.tier3.4_small_median

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_small_median <- ssd_fit_dists(risk.pass.tier3.4_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_small_median) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_small_median <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_small_median <- predict(dists_risk.pass.tier3.4_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_small_median <- risk.pass.tier3.4_small_median[order(risk.pass.tier3.4_small_median$Conc), ]
SSD_risk.pass.tier3.4_small_median$frac <- ppoints(risk.pass.tier3.4_small_median$Conc, 0.5)

risk.pass.tier3.4_small_median_hc5 <- c(pred_risk.pass.tier3.4_small_median$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_small_median_hc10 <- c(pred_risk.pass.tier3.4_small_median$est[10])

pred_risk.pass.tier3.4_small_median$est_format <-format(pred_risk.pass.tier3.4_small_median$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier3.4_small_median_ggplot <- ggplot(pred_risk.pass.tier3.4_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier3.4_small_median_ggplot
```

#### risk.pass.tier3.4_small_mean

```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_small_mean <- ssd_fit_dists(risk.pass.tier3.4_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_small_mean) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_small_mean <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_small_mean <- predict(dists_risk.pass.tier3.4_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_small_mean <- risk.pass.tier3.4_small_mean[order(risk.pass.tier3.4_small_mean$Conc), ]
SSD_risk.pass.tier3.4_small_mean$frac <- ppoints(risk.pass.tier3.4_small_mean$Conc, 0.5)

risk.pass.tier3.4_small_mean_hc5 <- c(pred_risk.pass.tier3.4_small_mean$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_small_mean_hc10 <- c(pred_risk.pass.tier3.4_small_mean$est[10])

pred_risk.pass.tier3.4_small_mean$est_format <-format(pred_risk.pass.tier3.4_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
risk.pass.tier3.4_small_mean_ggplot <- ggplot(pred_risk.pass.tier3.4_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
risk.pass.tier3.4_small_mean_ggplot
```

#### risk.pass.tier3.4_small_1q
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_small_1q <- ssd_fit_dists(risk.pass.tier3.4_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_small_1q) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_small_1q <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_small_1q <- predict(dists_risk.pass.tier3.4_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_small_1q <- risk.pass.tier3.4_small_1q[order(risk.pass.tier3.4_small_1q$Conc), ]
SSD_risk.pass.tier3.4_small_1q$frac <- ppoints(risk.pass.tier3.4_small_1q$Conc, 0.5)

risk.pass.tier3.4_small_1q_hc5 <- c(pred_risk.pass.tier3.4_small_1q$est[5])
#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_small_1q_hc10 <- c(pred_risk.pass.tier3.4_small_1q$est[10])

pred_risk.pass.tier3.4_small_1q$est_format <-format(pred_risk.pass.tier3.4_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier3.4_small_1q_ggplot <- ggplot(pred_risk.pass.tier3.4_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier3.4_small_1q_ggplot
```

#### risk.pass.tier3.4_small_min
```{r include=FALSE}
###### --modelling ####
dists_risk.pass.tier3.4_small_min <- ssd_fit_dists(risk.pass.tier3.4_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_risk.pass.tier3.4_small_min) #plots the distribution in ggplorisk.pass.tier2
#### Goodness of fit ####
gof_risk.pass.tier3.4_small_min <- as.data.frame(ssd_gof(dists_risk.pass.tier3.4_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_risk.pass.tier3.4_small_min <- predict(dists_risk.pass.tier3.4_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_risk.pass.tier3.4_small_min <- risk.pass.tier3.4_small_min[order(risk.pass.tier3.4_small_min$Conc), ]
SSD_risk.pass.tier3.4_small_min$frac <- ppoints(risk.pass.tier3.4_small_min$Conc, 0.5)

#extract hc5
risk.pass.tier3.4_small_min_hc5 <- c(pred_risk.pass.tier3.4_small_min$est[5])

#extrac hc10 (risk.pass.tier 4)
risk.pass.tier3.4_small_min_hc10 <- c(pred_risk.pass.tier3.4_small_min$est[10])
pred_risk.pass.tier3.4_small_min$est_format <-format(pred_risk.pass.tier3.4_small_min$est, digits = 3, scientific = TRUE)

#ggplot
risk.pass.tier3.4_small_min_ggplot <- ggplot(pred_risk.pass.tier3.4_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_risk.pass.tier3.4_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_risk.pass.tier3.4_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "risk.pass.tier3.4_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

risk.pass.tier3.4_small_min_ggplot
```

# Combine plots
## risk.pass.tier 1
### Small (1-10 um)s
```{r}
### risk.pass.tier1_small_median
ggplot(pred_risk.pass.tier1_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_risk.pass.tier1_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: risk.pass.tier1_small_mean ###
  geom_xribbon(data = pred_risk.pass.tier1_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_risk.pass.tier1_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_risk.pass.tier1_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: risk.pass.tier1_small_1q ###
    geom_xribbon(data = pred_risk.pass.tier1_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_risk.pass.tier1_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_risk.pass.tier1_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
### fourth line: risk.pass.tier1_small_min ###
    geom_xribbon(data = pred_risk.pass.tier1_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_risk.pass.tier1_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_risk.pass.tier1_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (risk.pass.tier 1)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### risk.pass.tier1_large_median
ggplot(pred_risk.pass.tier1_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_risk.pass.tier1_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: risk.pass.tier1_large_mean ###
  geom_xribbon(data = pred_risk.pass.tier1_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_risk.pass.tier1_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_risk.pass.tier1_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: risk.pass.tier1_large_1q ###
    geom_xribbon(data = pred_risk.pass.tier1_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_risk.pass.tier1_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_risk.pass.tier1_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
  ### fourth line: risk.pass.tier1_large_min ###
    geom_xribbon(data = pred_risk.pass.tier1_large_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_risk.pass.tier1_large_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_risk.pass.tier1_large_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (risk.pass.tier 1)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## risk.pass.tier 2
### Small (1-10 um)s
```{r}
### risk.pass.tier2_small_median
ggplot(pred_risk.pass.tier2_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_risk.pass.tier2_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: risk.pass.tier2_small_mean ###
  geom_xribbon(data = pred_risk.pass.tier2_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_risk.pass.tier2_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_risk.pass.tier2_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: risk.pass.tier2_small_1q ###
    geom_xribbon(data = pred_risk.pass.tier2_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_risk.pass.tier2_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_risk.pass.tier2_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  ### fourth line: risk.pass.tier2_small_min  ###
    geom_xribbon(data = pred_risk.pass.tier2_small_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_risk.pass.tier2_small_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_risk.pass.tier2_small_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
  ### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (risk.pass.tier 2)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### risk.pass.tier2_large_median
ggplot(pred_risk.pass.tier2_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_risk.pass.tier2_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: risk.pass.tier2_large_mean ###
  geom_xribbon(data = pred_risk.pass.tier2_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_risk.pass.tier2_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_risk.pass.tier2_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: risk.pass.tier2_large_1q  ###
    geom_xribbon(data = pred_risk.pass.tier2_large_1q , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_risk.pass.tier2_large_1q , aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_risk.pass.tier2_large_1q , aes(x = Conc, y =frac), 
                 color = "green") +  
  
    ### fourth line: risk.pass.tier2_large_min  ###
    geom_xribbon(data = pred_risk.pass.tier2_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_risk.pass.tier2_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_risk.pass.tier2_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (risk.pass.tier 2)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## risk.pass.tier 3/4
### Small (1-10 um)s
```{r}
### risk.pass.tier3.4_small_median
ggplot(pred_risk.pass.tier3.4_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_risk.pass.tier3.4_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: risk.pass.tier3.4_small_mean ###
  geom_xribbon(data = pred_risk.pass.tier3.4_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_risk.pass.tier3.4_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_risk.pass.tier3.4_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: risk.pass.tier3.4_small_1q ###
    geom_xribbon(data = pred_risk.pass.tier3.4_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_risk.pass.tier3.4_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_risk.pass.tier3.4_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: risk.pass.tier3.4_small_min ###
    geom_xribbon(data = pred_risk.pass.tier3.4_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_risk.pass.tier3.4_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_risk.pass.tier3.4_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") + 
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (risk.pass.tier 3/4)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = min"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### risk.pass.tier3.4_large_median
ggplot(pred_risk.pass.tier3.4_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_risk.pass.tier3.4_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: risk.pass.tier3.4_large_mean ###
  geom_xribbon(data = pred_risk.pass.tier3.4_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_risk.pass.tier3.4_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_risk.pass.tier3.4_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: risk.pass.tier3.4_large_1q ###
    geom_xribbon(data = pred_risk.pass.tier3.4_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_risk.pass.tier3.4_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_risk.pass.tier3.4_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: risk.pass.tier3.4_large_min  ###
    geom_xribbon(data = pred_risk.pass.tier3.4_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_risk.pass.tier3.4_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_risk.pass.tier3.4_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (risk.pass.tier 3/4)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```


## Summary Table
```{r}
# Small/Large x risk.pass.tier 1/2/3 x median/mean/q1 = 2 x 3 x 3 = 18 comparisons
larges <- list(risk.pass.tier1_large_median_hc5, risk.pass.tier1_large_mean_hc5, risk.pass.tier1_large_1q_hc5, risk.pass.tier1_large_min_hc5,
              risk.pass.tier1_large.obs[[1,1]], #n.obs
              risk.pass.tier1_large.obs[[1,2]], #n.studies
              risk.pass.tier1_large.obs[[1,3]], #n.taxa
              risk.pass.tier1_large.obs[[1,4]], #n.species
          #risk.pass.tier 2
          risk.pass.tier2_large_median_hc5, risk.pass.tier2_large_mean_hc5, risk.pass.tier2_large_1q_hc5, risk.pass.tier2_large_min_hc5,
          risk.pass.tier2_large.obs[[1,1]], #n.obs
          risk.pass.tier2_large.obs[[1,2]], #n.studies
          risk.pass.tier2_large.obs[[1,3]], #n.taxa
          risk.pass.tier2_large.obs[[1,4]], #n.species
          #risk.pass.tier 3 (hc5)
          risk.pass.tier3.4_large_median_hc5, risk.pass.tier3.4_large_mean_hc5, risk.pass.tier3.4_large_1q_hc5, risk.pass.tier3.4_large_min_hc5,
          risk.pass.tier3.4_large.obs[[1,1]], #n.obs
          risk.pass.tier3.4_large.obs[[1,2]], #n.studies
          risk.pass.tier3.4_large.obs[[1,3]], #n.taxa
          risk.pass.tier3.4_large.obs[[1,4]], #n.species
          #risk.pass.tier 4 (hc10)
          risk.pass.tier3.4_large_median_hc10, risk.pass.tier3.4_large_mean_hc10, risk.pass.tier3.4_large_1q_hc10, risk.pass.tier3.4_large_min_hc10,
          risk.pass.tier3.4_large.obs[[1,1]], #n.obs
          risk.pass.tier3.4_large.obs[[1,2]], #n.studies
          risk.pass.tier3.4_large.obs[[1,3]], #n.taxa
          risk.pass.tier3.4_large.obs[[1,4]]  #n.species
          )

smalls <- list(risk.pass.tier1_small_median_hc5, risk.pass.tier1_small_mean_hc5, risk.pass.tier1_small_1q_hc5, risk.pass.tier1_small_min_hc5,
               risk.pass.tier1_small.obs[[1,1]], #n.obs
               risk.pass.tier1_small.obs[[1,2]], #n.studies
               risk.pass.tier1_small.obs[[1,3]], #n.taxa
               risk.pass.tier1_small.obs[[1,4]], #n.species
          #risk.pass.tier 2
          risk.pass.tier2_small_median_hc5, risk.pass.tier2_small_mean_hc5, risk.pass.tier2_small_1q_hc5, risk.pass.tier2_small_min_hc5,
          risk.pass.tier2_small.obs[[1,1]], #n.obs
          risk.pass.tier2_small.obs[[1,2]], #n.studies
          risk.pass.tier2_small.obs[[1,3]], #n.taxa
          risk.pass.tier2_small.obs[[1,4]], #n.species
          #risk.pass.tier 3 (hc5)
          risk.pass.tier3.4_small_median_hc5, risk.pass.tier3.4_small_mean_hc5, risk.pass.tier3.4_small_1q_hc5, risk.pass.tier3.4_small_min_hc5,
          risk.pass.tier3.4_small.obs[[1,1]], #n.obs
          risk.pass.tier3.4_small.obs[[1,2]], #n.studies
          risk.pass.tier3.4_small.obs[[1,3]], #n.taxa
          risk.pass.tier3.4_small.obs[[1,4]], #n.species
          #risk.pass.tier 4 (hc10)
          risk.pass.tier3.4_small_median_hc10, risk.pass.tier3.4_small_mean_hc10, risk.pass.tier3.4_small_1q_hc10, risk.pass.tier3.4_small_min_hc10,
          risk.pass.tier3.4_small.obs[[1,1]], #n.obs
          risk.pass.tier3.4_small.obs[[1,2]], #n.studies
          risk.pass.tier3.4_small.obs[[1,3]], #n.taxa
          risk.pass.tier3.4_small.obs[[1,4]]  #n.species
          )

## Conver to data frames
largesdf <- data.frame(t(matrix(unlist(larges), ncol = 4)))
smallsdf <- data.frame(t(matrix(unlist(smalls), ncol = 4))) #t = transpose

# convert mg/L to ug/L
largesdf <- largesdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

smallsdf <- smallsdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

# rename columns and rows
colnames(largesdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")
colnames(smallsdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")

rownames(largesdf) <- c("tier 1", "tier 2", "tier 3", "tier 4")
rownames(smallsdf) <- c("tier 1", "tier 2", "tier 3", "tier 4")

# provide risk.pass.tier column
largestibble <- tibble(largesdf,
                       tier = rownames(largesdf))

#re-arrange columns
largestibble <- largestibble[c("tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

# provide risk.pass.tier column
smallstibble <- tibble(smallsdf,
                       tier = rownames(smallsdf))

#re-arrange columns
smallstibble <- smallstibble[c("tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

#function to create tables
hp_table <- function(x){
  #get full value range for whole table conditional formatting
  full_val_range <- x %>% 
    ungroup %>% 
    select_if(is.numeric) %>% 
    range
  
  #format colors accordingly
  gt(x) %>% 
    fmt_number(columns = vars(Mean, Median, Quartile_1, Minimum),
             n_sigfig = 2,
             use_seps = TRUE) %>% 
    data_color(
    columns = names(x)[2:5],
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(palette = "ggsci::teal_material") %>% as.character(),
      domain = full_val_range),
    alpha = 0.75) %>% 
    tab_options(column_labels.hidden = FALSE) %>% 
    as_raw_html() # return as html
}

#larges gt
larges_gt <- largestibble %>% 
  hp_table()

#smalls gt
smalls_gt <- smallstibble %>% 
  hp_table() 
  
## Combine
data.tables <- data.frame(smalls_table = smalls_gt,
                          larges_table = larges_gt)
#Combine
risk.pass.summary <- data.tables %>% 
  gt() %>% 
  fmt_markdown(columns = TRUE) %>% 
  cols_label(smalls_table = "1-10 um",
             larges_table = "10-5,000 um") %>% 
  tab_source_note(md("Calculated from SSDs")) %>% 
  tab_header(title = paste("Microplastics HC5", particle_mass_check_ssd,"by Data Collapse and risk.pass.tier"),
             subtitle = "Qualiter Filters: Risk (pass), tech (pass & fail)") 
#print
risk.pass.summary
```

# SSD Build (Tech Tier Pass, Risk Tier Fail)
## tech.pass.tier 1
### Large (10 - 5000 um) 
#### tech.pass.tier1_large_median

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_large_median <- ssd_fit_dists(tech.pass.tier1_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_large_median) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_large_median <- as.data.frame(ssd_gof(dists_tech.pass.tier1_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_large_median <- predict(dists_tech.pass.tier1_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_large_median <- tech.pass.tier1_large_median[order(tech.pass.tier1_large_median$Conc), ]
SSD_tech.pass.tier1_large_median$frac <- ppoints(tech.pass.tier1_large_median$Conc, 0.5)

tech.pass.tier1_large_median_hc5 <- c(pred_tech.pass.tier1_large_median$est[5])
pred_tech.pass.tier1_large_median$est_format <-format(pred_tech.pass.tier1_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
tech.pass.tier1_large_median_ggplot <- ggplot(pred_tech.pass.tier1_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier1_large_median_ggplot
```

#### tech.pass.tier1_large_mean

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_large_mean <- ssd_fit_dists(tech.pass.tier1_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_large_mean) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_large_mean <- as.data.frame(ssd_gof(dists_tech.pass.tier1_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_large_mean <- predict(dists_tech.pass.tier1_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_large_mean <- tech.pass.tier1_large_mean[order(tech.pass.tier1_large_mean$Conc), ]
SSD_tech.pass.tier1_large_mean$frac <- ppoints(tech.pass.tier1_large_mean$Conc, 0.5)

tech.pass.tier1_large_mean_hc5 <- c(pred_tech.pass.tier1_large_mean$est[5])
pred_tech.pass.tier1_large_mean$est_format <-format(pred_tech.pass.tier1_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
tech.pass.tier1_large_mean_ggplot <- ggplot(pred_tech.pass.tier1_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier1_large_mean_ggplot
```

#### tech.pass.tier1_large_1q
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_large_1q <- ssd_fit_dists(tech.pass.tier1_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_large_1q) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_large_1q <- as.data.frame(ssd_gof(dists_tech.pass.tier1_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_large_1q <- predict(dists_tech.pass.tier1_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_large_1q <- tech.pass.tier1_large_1q[order(tech.pass.tier1_large_1q$Conc), ]
SSD_tech.pass.tier1_large_1q$frac <- ppoints(tech.pass.tier1_large_1q$Conc, 0.5)

tech.pass.tier1_large_1q_hc5 <- c(pred_tech.pass.tier1_large_1q$est[5])
pred_tech.pass.tier1_large_1q$est_format <-format(pred_tech.pass.tier1_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier1_large_1q_ggplot <- ggplot(pred_tech.pass.tier1_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier1_large_1q_ggplot
```

#### tech.pass.tier1_large_min
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_large_min <- ssd_fit_dists(tech.pass.tier1_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_large_min) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_large_min <- as.data.frame(ssd_gof(dists_tech.pass.tier1_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_large_min <- predict(dists_tech.pass.tier1_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_large_min <- tech.pass.tier1_large_min[order(tech.pass.tier1_large_min$Conc), ]
SSD_tech.pass.tier1_large_min$frac <- ppoints(tech.pass.tier1_large_min$Conc, 0.5)

tech.pass.tier1_large_min_hc5 <- c(pred_tech.pass.tier1_large_min$est[5])
pred_tech.pass.tier1_large_min$est_format <-format(pred_tech.pass.tier1_large_min$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier1_large_min_ggplot <- ggplot(pred_tech.pass.tier1_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier1_large_min_ggplot
```

### Small (1-10 um) 
#### tech.pass.tier1_small_median

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_small_median <- ssd_fit_dists(tech.pass.tier1_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_small_median) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_small_median <- as.data.frame(ssd_gof(dists_tech.pass.tier1_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_small_median <- predict(dists_tech.pass.tier1_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_small_median <- tech.pass.tier1_small_median[order(tech.pass.tier1_small_median$Conc), ]
SSD_tech.pass.tier1_small_median$frac <- ppoints(tech.pass.tier1_small_median$Conc, 0.5)

tech.pass.tier1_small_median_hc5 <- c(pred_tech.pass.tier1_small_median$est[5])
pred_tech.pass.tier1_small_median$est_format <-format(pred_tech.pass.tier1_small_median$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier1_small_median_ggplot <- ggplot(pred_tech.pass.tier1_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier1_small_median_ggplot
```

#### tech.pass.tier1_small_mean

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_small_mean <- ssd_fit_dists(tech.pass.tier1_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_small_mean) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_small_mean <- as.data.frame(ssd_gof(dists_tech.pass.tier1_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_small_mean <- predict(dists_tech.pass.tier1_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_small_mean <- tech.pass.tier1_small_mean[order(tech.pass.tier1_small_mean$Conc), ]
SSD_tech.pass.tier1_small_mean$frac <- ppoints(tech.pass.tier1_small_mean$Conc, 0.5)

tech.pass.tier1_small_mean_hc5 <- c(pred_tech.pass.tier1_small_mean$est[5])
pred_tech.pass.tier1_small_mean$est_format <-format(pred_tech.pass.tier1_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
tech.pass.tier1_small_mean_ggplot <- ggplot(pred_tech.pass.tier1_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier1_small_mean_ggplot
```

#### tech.pass.tier1_small_1q
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_small_1q <- ssd_fit_dists(tech.pass.tier1_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_small_1q) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_small_1q <- as.data.frame(ssd_gof(dists_tech.pass.tier1_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_small_1q <- predict(dists_tech.pass.tier1_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_small_1q <- tech.pass.tier1_small_1q[order(tech.pass.tier1_small_1q$Conc), ]
SSD_tech.pass.tier1_small_1q$frac <- ppoints(tech.pass.tier1_small_1q$Conc, 0.5)

tech.pass.tier1_small_1q_hc5 <- c(pred_tech.pass.tier1_small_1q$est[5])
pred_tech.pass.tier1_small_1q$est_format <-format(pred_tech.pass.tier1_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier1_small_1q_ggplot <- ggplot(pred_tech.pass.tier1_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier1_small_1q_ggplot
```

#### tech.pass.tier1_small_min
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier1_small_min <- ssd_fit_dists(tech.pass.tier1_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier1_small_min) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier1_small_min <- as.data.frame(ssd_gof(dists_tech.pass.tier1_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier1_small_min <- predict(dists_tech.pass.tier1_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier1_small_min <- tech.pass.tier1_small_min[order(tech.pass.tier1_small_min$Conc), ]
SSD_tech.pass.tier1_small_min$frac <- ppoints(tech.pass.tier1_small_min$Conc, 0.5)

tech.pass.tier1_small_min_hc5 <- c(pred_tech.pass.tier1_small_min$est[5])
pred_tech.pass.tier1_small_min$est_format <-format(pred_tech.pass.tier1_small_min$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier1_small_min_ggplot <- ggplot(pred_tech.pass.tier1_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier1_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier1_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier1_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier1_small_min_ggplot
```

## tech.pass.tier 2
### Large (10 - 5000 um) 
#### tech.pass.tier2_large_median

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_large_median <- ssd_fit_dists(tech.pass.tier2_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_large_median) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_large_median <- as.data.frame(ssd_gof(dists_tech.pass.tier2_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_large_median <- predict(dists_tech.pass.tier2_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_large_median <- tech.pass.tier2_large_median[order(tech.pass.tier2_large_median$Conc), ]
SSD_tech.pass.tier2_large_median$frac <- ppoints(tech.pass.tier2_large_median$Conc, 0.5)

tech.pass.tier2_large_median_hc5 <- c(pred_tech.pass.tier2_large_median$est[5])
pred_tech.pass.tier2_large_median$est_format <-format(pred_tech.pass.tier2_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
tech.pass.tier2_large_median_ggplot <- ggplot(pred_tech.pass.tier2_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier2_large_median_ggplot
```

#### tech.pass.tier2_large_mean

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_large_mean <- ssd_fit_dists(tech.pass.tier2_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_large_mean) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_large_mean <- as.data.frame(ssd_gof(dists_tech.pass.tier2_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_large_mean <- predict(dists_tech.pass.tier2_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_large_mean <- tech.pass.tier2_large_mean[order(tech.pass.tier2_large_mean$Conc), ]
SSD_tech.pass.tier2_large_mean$frac <- ppoints(tech.pass.tier2_large_mean$Conc, 0.5)

tech.pass.tier2_large_mean_hc5 <- c(pred_tech.pass.tier2_large_mean$est[5])
pred_tech.pass.tier2_large_mean$est_format <-format(pred_tech.pass.tier2_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
tech.pass.tier2_large_mean_ggplot <- ggplot(pred_tech.pass.tier2_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier2_large_mean_ggplot
```

#### tech.pass.tier2_large_1q
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_large_1q <- ssd_fit_dists(tech.pass.tier2_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_large_1q) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_large_1q <- as.data.frame(ssd_gof(dists_tech.pass.tier2_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_large_1q <- predict(dists_tech.pass.tier2_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_large_1q <- tech.pass.tier2_large_1q[order(tech.pass.tier2_large_1q$Conc), ]
SSD_tech.pass.tier2_large_1q$frac <- ppoints(tech.pass.tier2_large_1q$Conc, 0.5)

tech.pass.tier2_large_1q_hc5 <- c(pred_tech.pass.tier2_large_1q$est[5])
pred_tech.pass.tier2_large_1q$est_format <-format(pred_tech.pass.tier2_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier2_large_1q_ggplot <- ggplot(pred_tech.pass.tier2_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier2_large_1q_ggplot
```

#### tech.pass.tier2_large_min
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_large_min <- ssd_fit_dists(tech.pass.tier2_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_large_min) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_large_min <- as.data.frame(ssd_gof(dists_tech.pass.tier2_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_large_min <- predict(dists_tech.pass.tier2_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_large_min <- tech.pass.tier2_large_min[order(tech.pass.tier2_large_min$Conc), ]
SSD_tech.pass.tier2_large_min$frac <- ppoints(tech.pass.tier2_large_min$Conc, 0.5)

tech.pass.tier2_large_min_hc5 <- c(pred_tech.pass.tier2_large_min$est[5])
pred_tech.pass.tier2_large_min$est_format <-format(pred_tech.pass.tier2_large_min$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier2_large_min_ggplot <- ggplot(pred_tech.pass.tier2_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier2_large_min_ggplot
```
### Small (1-10 um) 
#### tech.pass.tier2_small_median

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_small_median <- ssd_fit_dists(tech.pass.tier2_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_small_median) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_small_median <- as.data.frame(ssd_gof(dists_tech.pass.tier2_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_small_median <- predict(dists_tech.pass.tier2_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_small_median <- tech.pass.tier2_small_median[order(tech.pass.tier2_small_median$Conc), ]
SSD_tech.pass.tier2_small_median$frac <- ppoints(tech.pass.tier2_small_median$Conc, 0.5)

tech.pass.tier2_small_median_hc5 <- c(pred_tech.pass.tier2_small_median$est[5])
pred_tech.pass.tier2_small_median$est_format <-format(pred_tech.pass.tier2_small_median$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier2_small_median_ggplot <- ggplot(pred_tech.pass.tier2_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier2_small_median_ggplot
```

#### tech.pass.tier2_small_mean

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_small_mean <- ssd_fit_dists(tech.pass.tier2_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_small_mean) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_small_mean <- as.data.frame(ssd_gof(dists_tech.pass.tier2_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_small_mean <- predict(dists_tech.pass.tier2_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_small_mean <- tech.pass.tier2_small_mean[order(tech.pass.tier2_small_mean$Conc), ]
SSD_tech.pass.tier2_small_mean$frac <- ppoints(tech.pass.tier2_small_mean$Conc, 0.5)

tech.pass.tier2_small_mean_hc5 <- c(pred_tech.pass.tier2_small_mean$est[5])
pred_tech.pass.tier2_small_mean$est_format <-format(pred_tech.pass.tier2_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
tech.pass.tier2_small_mean_ggplot <- ggplot(pred_tech.pass.tier2_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier2_small_mean_ggplot
```

#### tech.pass.tier2_small_1q
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_small_1q <- ssd_fit_dists(tech.pass.tier2_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_small_1q) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_small_1q <- as.data.frame(ssd_gof(dists_tech.pass.tier2_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_small_1q <- predict(dists_tech.pass.tier2_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_small_1q <- tech.pass.tier2_small_1q[order(tech.pass.tier2_small_1q$Conc), ]
SSD_tech.pass.tier2_small_1q$frac <- ppoints(tech.pass.tier2_small_1q$Conc, 0.5)

tech.pass.tier2_small_1q_hc5 <- c(pred_tech.pass.tier2_small_1q$est[5])
pred_tech.pass.tier2_small_1q$est_format <-format(pred_tech.pass.tier2_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier2_small_1q_ggplot <- ggplot(pred_tech.pass.tier2_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier2_small_1q_ggplot
```

#### tech.pass.tier2_small_min
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier2_small_min <- ssd_fit_dists(tech.pass.tier2_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier2_small_min) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier2_small_min <- as.data.frame(ssd_gof(dists_tech.pass.tier2_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier2_small_min <- predict(dists_tech.pass.tier2_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier2_small_min <- tech.pass.tier2_small_min[order(tech.pass.tier2_small_min$Conc), ]
SSD_tech.pass.tier2_small_min$frac <- ppoints(tech.pass.tier2_small_min$Conc, 0.5)

tech.pass.tier2_small_min_hc5 <- c(pred_tech.pass.tier2_small_min$est[5])
pred_tech.pass.tier2_small_min$est_format <-format(pred_tech.pass.tier2_small_min$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier2_small_min_ggplot <- ggplot(pred_tech.pass.tier2_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier2_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier2_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier2_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier2_small_min_ggplot
```

## tech.pass.tier 3
### Large (10 - 5000 um) 
#### tech.pass.tier3.4_large_median

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_large_median <- ssd_fit_dists(tech.pass.tier3.4_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_large_median) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_large_median <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_large_median <- predict(dists_tech.pass.tier3.4_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_large_median <- tech.pass.tier3.4_large_median[order(tech.pass.tier3.4_large_median$Conc), ]
SSD_tech.pass.tier3.4_large_median$frac <- ppoints(tech.pass.tier3.4_large_median$Conc, 0.5)

tech.pass.tier3.4_large_median_hc5 <- c(pred_tech.pass.tier3.4_large_median$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_large_median_hc10 <- c(pred_tech.pass.tier3.4_large_median$est[10])
pred_tech.pass.tier3.4_large_median$est_format <-format(pred_tech.pass.tier3.4_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
tech.pass.tier3.4_large_median_ggplot <- ggplot(pred_tech.pass.tier3.4_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier3.4_large_median_ggplot
```

#### tech.pass.tier3.4_large_mean

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_large_mean <- ssd_fit_dists(tech.pass.tier3.4_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_large_mean) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_large_mean <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_large_mean <- predict(dists_tech.pass.tier3.4_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_large_mean <- tech.pass.tier3.4_large_mean[order(tech.pass.tier3.4_large_mean$Conc), ]
SSD_tech.pass.tier3.4_large_mean$frac <- ppoints(tech.pass.tier3.4_large_mean$Conc, 0.5)

tech.pass.tier3.4_large_mean_hc5 <- c(pred_tech.pass.tier3.4_large_mean$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_large_mean_hc10 <- c(pred_tech.pass.tier3.4_large_mean$est[10])

pred_tech.pass.tier3.4_large_mean$est_format <-format(pred_tech.pass.tier3.4_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
tech.pass.tier3.4_large_mean_ggplot <- ggplot(pred_tech.pass.tier3.4_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier3.4_large_mean_ggplot
```

#### tech.pass.tier3.4_large_1q
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_large_1q <- ssd_fit_dists(tech.pass.tier3.4_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_large_1q) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_large_1q <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_large_1q <- predict(dists_tech.pass.tier3.4_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_large_1q <- tech.pass.tier3.4_large_1q[order(tech.pass.tier3.4_large_1q$Conc), ]
SSD_tech.pass.tier3.4_large_1q$frac <- ppoints(tech.pass.tier3.4_large_1q$Conc, 0.5)

tech.pass.tier3.4_large_1q_hc5 <- c(pred_tech.pass.tier3.4_large_1q$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_large_1q_hc10 <- c(pred_tech.pass.tier3.4_large_1q$est[10])
pred_tech.pass.tier3.4_large_1q$est_format <-format(pred_tech.pass.tier3.4_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier3.4_large_1q_ggplot <- ggplot(pred_tech.pass.tier3.4_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier3.4_large_1q_ggplot
```

#### tech.pass.tier3.4_large_min
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_large_min <- ssd_fit_dists(tech.pass.tier3.4_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_large_min) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_large_min <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_large_min <- predict(dists_tech.pass.tier3.4_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_large_min <- tech.pass.tier3.4_large_min[order(tech.pass.tier3.4_large_min$Conc), ]
SSD_tech.pass.tier3.4_large_min$frac <- ppoints(tech.pass.tier3.4_large_min$Conc, 0.5)

tech.pass.tier3.4_large_min_hc5 <- c(pred_tech.pass.tier3.4_large_min$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_large_min_hc10 <- c(pred_tech.pass.tier3.4_large_min$est[10])
pred_tech.pass.tier3.4_large_min$est_format <-format(pred_tech.pass.tier3.4_large_min$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier3.4_large_min_ggplot <- ggplot(pred_tech.pass.tier3.4_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier3.4_large_min_ggplot
```

### Small (1-10 um) 
#### tech.pass.tier3.4_small_median

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_small_median <- ssd_fit_dists(tech.pass.tier3.4_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_small_median) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_small_median <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_small_median <- predict(dists_tech.pass.tier3.4_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_small_median <- tech.pass.tier3.4_small_median[order(tech.pass.tier3.4_small_median$Conc), ]
SSD_tech.pass.tier3.4_small_median$frac <- ppoints(tech.pass.tier3.4_small_median$Conc, 0.5)

tech.pass.tier3.4_small_median_hc5 <- c(pred_tech.pass.tier3.4_small_median$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_small_median_hc10 <- c(pred_tech.pass.tier3.4_small_median$est[10])

pred_tech.pass.tier3.4_small_median$est_format <-format(pred_tech.pass.tier3.4_small_median$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier3.4_small_median_ggplot <- ggplot(pred_tech.pass.tier3.4_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier3.4_small_median_ggplot
```

#### tech.pass.tier3.4_small_mean

```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_small_mean <- ssd_fit_dists(tech.pass.tier3.4_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_small_mean) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_small_mean <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_small_mean <- predict(dists_tech.pass.tier3.4_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_small_mean <- tech.pass.tier3.4_small_mean[order(tech.pass.tier3.4_small_mean$Conc), ]
SSD_tech.pass.tier3.4_small_mean$frac <- ppoints(tech.pass.tier3.4_small_mean$Conc, 0.5)

tech.pass.tier3.4_small_mean_hc5 <- c(pred_tech.pass.tier3.4_small_mean$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_small_mean_hc10 <- c(pred_tech.pass.tier3.4_small_mean$est[10])

pred_tech.pass.tier3.4_small_mean$est_format <-format(pred_tech.pass.tier3.4_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
tech.pass.tier3.4_small_mean_ggplot <- ggplot(pred_tech.pass.tier3.4_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
tech.pass.tier3.4_small_mean_ggplot
```

#### tech.pass.tier3.4_small_1q
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_small_1q <- ssd_fit_dists(tech.pass.tier3.4_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_small_1q) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_small_1q <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_small_1q <- predict(dists_tech.pass.tier3.4_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_small_1q <- tech.pass.tier3.4_small_1q[order(tech.pass.tier3.4_small_1q$Conc), ]
SSD_tech.pass.tier3.4_small_1q$frac <- ppoints(tech.pass.tier3.4_small_1q$Conc, 0.5)

tech.pass.tier3.4_small_1q_hc5 <- c(pred_tech.pass.tier3.4_small_1q$est[5])
#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_small_1q_hc10 <- c(pred_tech.pass.tier3.4_small_1q$est[10])

pred_tech.pass.tier3.4_small_1q$est_format <-format(pred_tech.pass.tier3.4_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier3.4_small_1q_ggplot <- ggplot(pred_tech.pass.tier3.4_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier3.4_small_1q_ggplot
```

#### tech.pass.tier3.4_small_min
```{r include=FALSE}
###### --modelling ####
dists_tech.pass.tier3.4_small_min <- ssd_fit_dists(tech.pass.tier3.4_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_tech.pass.tier3.4_small_min) #plots the distribution in ggplotech.pass.tier2
#### Goodness of fit ####
gof_tech.pass.tier3.4_small_min <- as.data.frame(ssd_gof(dists_tech.pass.tier3.4_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_tech.pass.tier3.4_small_min <- predict(dists_tech.pass.tier3.4_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_tech.pass.tier3.4_small_min <- tech.pass.tier3.4_small_min[order(tech.pass.tier3.4_small_min$Conc), ]
SSD_tech.pass.tier3.4_small_min$frac <- ppoints(tech.pass.tier3.4_small_min$Conc, 0.5)

#extract hc5
tech.pass.tier3.4_small_min_hc5 <- c(pred_tech.pass.tier3.4_small_min$est[5])

#extrac hc10 (tech.pass.tier 4)
tech.pass.tier3.4_small_min_hc10 <- c(pred_tech.pass.tier3.4_small_min$est[10])
pred_tech.pass.tier3.4_small_min$est_format <-format(pred_tech.pass.tier3.4_small_min$est, digits = 3, scientific = TRUE)

#ggplot
tech.pass.tier3.4_small_min_ggplot <- ggplot(pred_tech.pass.tier3.4_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_tech.pass.tier3.4_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_tech.pass.tier3.4_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "tech.pass.tier3.4_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

tech.pass.tier3.4_small_min_ggplot
```

# Combine plots
## tech.pass.tier 1
### Small (1-10 um)s
```{r}
### tech.pass.tier1_small_median
ggplot(pred_tech.pass.tier1_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tech.pass.tier1_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tech.pass.tier1_small_mean ###
  geom_xribbon(data = pred_tech.pass.tier1_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tech.pass.tier1_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tech.pass.tier1_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tech.pass.tier1_small_1q ###
    geom_xribbon(data = pred_tech.pass.tier1_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tech.pass.tier1_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tech.pass.tier1_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
### fourth line: tech.pass.tier1_small_min ###
    geom_xribbon(data = pred_tech.pass.tier1_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tech.pass.tier1_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tech.pass.tier1_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (tech.pass.tier 1)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### tech.pass.tier1_large_median
ggplot(pred_tech.pass.tier1_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tech.pass.tier1_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tech.pass.tier1_large_mean ###
  geom_xribbon(data = pred_tech.pass.tier1_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tech.pass.tier1_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tech.pass.tier1_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tech.pass.tier1_large_1q ###
    geom_xribbon(data = pred_tech.pass.tier1_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tech.pass.tier1_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tech.pass.tier1_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
  ### fourth line: tech.pass.tier1_large_min ###
    geom_xribbon(data = pred_tech.pass.tier1_large_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tech.pass.tier1_large_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tech.pass.tier1_large_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (tech.pass.tier 1)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## tech.pass.tier 2
### Small (1-10 um)s
```{r}
### tech.pass.tier2_small_median
ggplot(pred_tech.pass.tier2_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tech.pass.tier2_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tech.pass.tier2_small_mean ###
  geom_xribbon(data = pred_tech.pass.tier2_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tech.pass.tier2_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tech.pass.tier2_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tech.pass.tier2_small_1q ###
    geom_xribbon(data = pred_tech.pass.tier2_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tech.pass.tier2_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tech.pass.tier2_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  ### fourth line: tech.pass.tier2_small_min  ###
    geom_xribbon(data = pred_tech.pass.tier2_small_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tech.pass.tier2_small_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tech.pass.tier2_small_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
  ### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (tech.pass.tier 2)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### tech.pass.tier2_large_median
ggplot(pred_tech.pass.tier2_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tech.pass.tier2_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tech.pass.tier2_large_mean ###
  geom_xribbon(data = pred_tech.pass.tier2_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tech.pass.tier2_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tech.pass.tier2_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tech.pass.tier2_large_1q  ###
    geom_xribbon(data = pred_tech.pass.tier2_large_1q , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tech.pass.tier2_large_1q , aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tech.pass.tier2_large_1q , aes(x = Conc, y =frac), 
                 color = "green") +  
  
    ### fourth line: tech.pass.tier2_large_min  ###
    geom_xribbon(data = pred_tech.pass.tier2_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tech.pass.tier2_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tech.pass.tier2_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (tech.pass.tier 2)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## tech.pass.tier 3/4
### Small (1-10 um)s
```{r}
### tech.pass.tier3.4_small_median
ggplot(pred_tech.pass.tier3.4_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tech.pass.tier3.4_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tech.pass.tier3.4_small_mean ###
  geom_xribbon(data = pred_tech.pass.tier3.4_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tech.pass.tier3.4_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tech.pass.tier3.4_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tech.pass.tier3.4_small_1q ###
    geom_xribbon(data = pred_tech.pass.tier3.4_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tech.pass.tier3.4_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tech.pass.tier3.4_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: tech.pass.tier3.4_small_min ###
    geom_xribbon(data = pred_tech.pass.tier3.4_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tech.pass.tier3.4_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tech.pass.tier3.4_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") + 
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (tech.pass.tier 3/4)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = min"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### tech.pass.tier3.4_large_median
ggplot(pred_tech.pass.tier3.4_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_tech.pass.tier3.4_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: tech.pass.tier3.4_large_mean ###
  geom_xribbon(data = pred_tech.pass.tier3.4_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_tech.pass.tier3.4_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_tech.pass.tier3.4_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: tech.pass.tier3.4_large_1q ###
    geom_xribbon(data = pred_tech.pass.tier3.4_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_tech.pass.tier3.4_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_tech.pass.tier3.4_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: tech.pass.tier3.4_large_min  ###
    geom_xribbon(data = pred_tech.pass.tier3.4_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_tech.pass.tier3.4_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_tech.pass.tier3.4_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (tech.pass.tier 3/4)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
## Summary Table
```{r}
# Small/Large x tech.pass.tier 1/2/3 x median/mean/q1 = 2 x 3 x 3 = 18 comparisons
larges <- list(tech.pass.tier1_large_median_hc5, tech.pass.tier1_large_mean_hc5, tech.pass.tier1_large_1q_hc5, tech.pass.tier1_large_min_hc5,
              tech.pass.tier1_large.obs[[1,1]], #n.obs
              tech.pass.tier1_large.obs[[1,2]], #n.studies
              tech.pass.tier1_large.obs[[1,3]], #n.taxa
              tech.pass.tier1_large.obs[[1,4]], #n.species
          #tech.pass.tier 2
          tech.pass.tier2_large_median_hc5, tech.pass.tier2_large_mean_hc5, tech.pass.tier2_large_1q_hc5, tech.pass.tier2_large_min_hc5,
          tech.pass.tier2_large.obs[[1,1]], #n.obs
          tech.pass.tier2_large.obs[[1,2]], #n.studies
          tech.pass.tier2_large.obs[[1,3]], #n.taxa
          tech.pass.tier2_large.obs[[1,4]], #n.species
          #tech.pass.tier 3 (hc5)
          tech.pass.tier3.4_large_median_hc5, tech.pass.tier3.4_large_mean_hc5, tech.pass.tier3.4_large_1q_hc5, tech.pass.tier3.4_large_min_hc5,
          tech.pass.tier3.4_large.obs[[1,1]], #n.obs
          tech.pass.tier3.4_large.obs[[1,2]], #n.studies
          tech.pass.tier3.4_large.obs[[1,3]], #n.taxa
          tech.pass.tier3.4_large.obs[[1,4]], #n.species
          #tech.pass.tier 4 (hc10)
          tech.pass.tier3.4_large_median_hc10, tech.pass.tier3.4_large_mean_hc10, tech.pass.tier3.4_large_1q_hc10, tech.pass.tier3.4_large_min_hc10,
          tech.pass.tier3.4_large.obs[[1,1]], #n.obs
          tech.pass.tier3.4_large.obs[[1,2]], #n.studies
          tech.pass.tier3.4_large.obs[[1,3]], #n.taxa
          tech.pass.tier3.4_large.obs[[1,4]]  #n.species
          )

smalls <- list(tech.pass.tier1_small_median_hc5, tech.pass.tier1_small_mean_hc5, tech.pass.tier1_small_1q_hc5, tech.pass.tier1_small_min_hc5,
               tech.pass.tier1_small.obs[[1,1]], #n.obs
               tech.pass.tier1_small.obs[[1,2]], #n.studies
               tech.pass.tier1_small.obs[[1,3]], #n.taxa
               tech.pass.tier1_small.obs[[1,4]], #n.species
          #tech.pass.tier 2
          tech.pass.tier2_small_median_hc5, tech.pass.tier2_small_mean_hc5, tech.pass.tier2_small_1q_hc5, tech.pass.tier2_small_min_hc5,
          tech.pass.tier2_small.obs[[1,1]], #n.obs
          tech.pass.tier2_small.obs[[1,2]], #n.studies
          tech.pass.tier2_small.obs[[1,3]], #n.taxa
          tech.pass.tier2_small.obs[[1,4]], #n.species
          #tech.pass.tier 3 (hc5)
          tech.pass.tier3.4_small_median_hc5, tech.pass.tier3.4_small_mean_hc5, tech.pass.tier3.4_small_1q_hc5, tech.pass.tier3.4_small_min_hc5,
          tech.pass.tier3.4_small.obs[[1,1]], #n.obs
          tech.pass.tier3.4_small.obs[[1,2]], #n.studies
          tech.pass.tier3.4_small.obs[[1,3]], #n.taxa
          tech.pass.tier3.4_small.obs[[1,4]], #n.species
          #tech.pass.tier 4 (hc10)
          tech.pass.tier3.4_small_median_hc10, tech.pass.tier3.4_small_mean_hc10, tech.pass.tier3.4_small_1q_hc10, tech.pass.tier3.4_small_min_hc10,
          tech.pass.tier3.4_small.obs[[1,1]], #n.obs
          tech.pass.tier3.4_small.obs[[1,2]], #n.studies
          tech.pass.tier3.4_small.obs[[1,3]], #n.taxa
          tech.pass.tier3.4_small.obs[[1,4]]  #n.species
          )

## Conver to data frames
largesdf <- data.frame(t(matrix(unlist(larges), ncol = 4)))
smallsdf <- data.frame(t(matrix(unlist(smalls), ncol = 4))) #t = transpose

# convert mg/L to ug/L
largesdf <- largesdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

smallsdf <- smallsdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

# rename columns and rows
colnames(largesdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")
colnames(smallsdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")

rownames(largesdf) <- c("Tier 1", "Tier 2", "Tier 3", "Tier 4")
rownames(smallsdf) <- c("Tier 1", "Tier 2", "Tier 3", "Tier 4")

# provide tier column
largestibble <- tibble(largesdf,
                       Tier = rownames(largesdf))

#re-arrange columns
largestibble <- largestibble[c("Tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

# provide tier column
smallstibble <- tibble(smallsdf,
                       Tier = rownames(smallsdf))

#re-arrange columns
smallstibble <- smallstibble[c("Tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

#function to create tables
hp_table <- function(x){
  #get full value range for whole table conditional formatting
  full_val_range <- x %>% 
    ungroup %>% 
    select_if(is.numeric) %>% 
    range
  
  #format colors accordingly
  gt(x) %>% 
    fmt_number(columns = vars(Mean, Median, Quartile_1, Minimum),
             n_sigfig = 2,
             use_seps = TRUE) %>% 
    data_color(
    columns = names(x)[2:5],
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(palette = "ggsci::teal_material") %>% as.character(),
      domain = full_val_range),
    alpha = 0.75) %>% 
    tab_options(column_labels.hidden = FALSE) %>% 
    as_raw_html() # return as html
}

#larges gt
larges_gt <- largestibble %>% 
  hp_table()

#smalls gt
smalls_gt <- smallstibble %>% 
  hp_table() 
  
## Combine
data.tables <- data.frame(smalls_table = smalls_gt,
                          larges_table = larges_gt)
#Combine
tech.pass.summary <- data.tables %>% 
  gt() %>% 
  fmt_markdown(columns = TRUE) %>% 
  cols_label(smalls_table = "1-10 um",
             larges_table = "10-5,000 um") %>% 
  tab_source_note(md("Calculated from SSDs")) %>% 
  tab_header(title = paste("Microplastics HC5", particle_mass_check_ssd, "by Data Collapse and Tier"),
             subtitle = "Qualiter Filters: Risk (pass & fail) Tech (pass)") 
#print
tech.pass.summary
```

# SSD Build(All Fail)
## allFail.tier 1
### Large (10 - 5000 um) 
#### allFail.tier1_large_median

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_large_median <- ssd_fit_dists(allFail.tier1_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_large_median) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_large_median <- as.data.frame(ssd_gof(dists_allFail.tier1_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_large_median <- predict(dists_allFail.tier1_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_large_median <- allFail.tier1_large_median[order(allFail.tier1_large_median$Conc), ]
SSD_allFail.tier1_large_median$frac <- ppoints(allFail.tier1_large_median$Conc, 0.5)

allFail.tier1_large_median_hc5 <- c(pred_allFail.tier1_large_median$est[5])
pred_allFail.tier1_large_median$est_format <-format(pred_allFail.tier1_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
allFail.tier1_large_median_ggplot <- ggplot(pred_allFail.tier1_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier1_large_median_ggplot
```

#### allFail.tier1_large_mean

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_large_mean <- ssd_fit_dists(allFail.tier1_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_large_mean) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_large_mean <- as.data.frame(ssd_gof(dists_allFail.tier1_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_large_mean <- predict(dists_allFail.tier1_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_large_mean <- allFail.tier1_large_mean[order(allFail.tier1_large_mean$Conc), ]
SSD_allFail.tier1_large_mean$frac <- ppoints(allFail.tier1_large_mean$Conc, 0.5)

allFail.tier1_large_mean_hc5 <- c(pred_allFail.tier1_large_mean$est[5])
pred_allFail.tier1_large_mean$est_format <-format(pred_allFail.tier1_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
allFail.tier1_large_mean_ggplot <- ggplot(pred_allFail.tier1_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier1_large_mean_ggplot
```

#### allFail.tier1_large_1q
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_large_1q <- ssd_fit_dists(allFail.tier1_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_large_1q) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_large_1q <- as.data.frame(ssd_gof(dists_allFail.tier1_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_large_1q <- predict(dists_allFail.tier1_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_large_1q <- allFail.tier1_large_1q[order(allFail.tier1_large_1q$Conc), ]
SSD_allFail.tier1_large_1q$frac <- ppoints(allFail.tier1_large_1q$Conc, 0.5)

allFail.tier1_large_1q_hc5 <- c(pred_allFail.tier1_large_1q$est[5])
pred_allFail.tier1_large_1q$est_format <-format(pred_allFail.tier1_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier1_large_1q_ggplot <- ggplot(pred_allFail.tier1_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier1_large_1q_ggplot
```

#### allFail.tier1_large_min
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_large_min <- ssd_fit_dists(allFail.tier1_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_large_min) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_large_min <- as.data.frame(ssd_gof(dists_allFail.tier1_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_large_min <- predict(dists_allFail.tier1_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_large_min <- allFail.tier1_large_min[order(allFail.tier1_large_min$Conc), ]
SSD_allFail.tier1_large_min$frac <- ppoints(allFail.tier1_large_min$Conc, 0.5)

allFail.tier1_large_min_hc5 <- c(pred_allFail.tier1_large_min$est[5])
pred_allFail.tier1_large_min$est_format <-format(pred_allFail.tier1_large_min$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier1_large_min_ggplot <- ggplot(pred_allFail.tier1_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier1_large_min_ggplot
```

### Small (1-10 um) 
#### allFail.tier1_small_median

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_small_median <- ssd_fit_dists(allFail.tier1_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_small_median) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_small_median <- as.data.frame(ssd_gof(dists_allFail.tier1_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_small_median <- predict(dists_allFail.tier1_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_small_median <- allFail.tier1_small_median[order(allFail.tier1_small_median$Conc), ]
SSD_allFail.tier1_small_median$frac <- ppoints(allFail.tier1_small_median$Conc, 0.5)

allFail.tier1_small_median_hc5 <- c(pred_allFail.tier1_small_median$est[5])
pred_allFail.tier1_small_median$est_format <-format(pred_allFail.tier1_small_median$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier1_small_median_ggplot <- ggplot(pred_allFail.tier1_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier1_small_median_ggplot
```

#### allFail.tier1_small_mean

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_small_mean <- ssd_fit_dists(allFail.tier1_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_small_mean) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_small_mean <- as.data.frame(ssd_gof(dists_allFail.tier1_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_small_mean <- predict(dists_allFail.tier1_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_small_mean <- allFail.tier1_small_mean[order(allFail.tier1_small_mean$Conc), ]
SSD_allFail.tier1_small_mean$frac <- ppoints(allFail.tier1_small_mean$Conc, 0.5)

allFail.tier1_small_mean_hc5 <- c(pred_allFail.tier1_small_mean$est[5])
pred_allFail.tier1_small_mean$est_format <-format(pred_allFail.tier1_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
allFail.tier1_small_mean_ggplot <- ggplot(pred_allFail.tier1_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier1_small_mean_ggplot
```

#### allFail.tier1_small_1q
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_small_1q <- ssd_fit_dists(allFail.tier1_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_small_1q) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_small_1q <- as.data.frame(ssd_gof(dists_allFail.tier1_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_small_1q <- predict(dists_allFail.tier1_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_small_1q <- allFail.tier1_small_1q[order(allFail.tier1_small_1q$Conc), ]
SSD_allFail.tier1_small_1q$frac <- ppoints(allFail.tier1_small_1q$Conc, 0.5)

allFail.tier1_small_1q_hc5 <- c(pred_allFail.tier1_small_1q$est[5])
pred_allFail.tier1_small_1q$est_format <-format(pred_allFail.tier1_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier1_small_1q_ggplot <- ggplot(pred_allFail.tier1_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier1_small_1q_ggplot
```

#### allFail.tier1_small_min
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier1_small_min <- ssd_fit_dists(allFail.tier1_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier1_small_min) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier1_small_min <- as.data.frame(ssd_gof(dists_allFail.tier1_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier1_small_min <- predict(dists_allFail.tier1_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier1_small_min <- allFail.tier1_small_min[order(allFail.tier1_small_min$Conc), ]
SSD_allFail.tier1_small_min$frac <- ppoints(allFail.tier1_small_min$Conc, 0.5)

allFail.tier1_small_min_hc5 <- c(pred_allFail.tier1_small_min$est[5])
pred_allFail.tier1_small_min$est_format <-format(pred_allFail.tier1_small_min$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier1_small_min_ggplot <- ggplot(pred_allFail.tier1_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier1_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier1_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier1_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier1_small_min_ggplot
```

## allFail.tier 2
### Large (10 - 5000 um) 
#### allFail.tier2_large_median

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_large_median <- ssd_fit_dists(allFail.tier2_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_large_median) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_large_median <- as.data.frame(ssd_gof(dists_allFail.tier2_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_large_median <- predict(dists_allFail.tier2_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_large_median <- allFail.tier2_large_median[order(allFail.tier2_large_median$Conc), ]
SSD_allFail.tier2_large_median$frac <- ppoints(allFail.tier2_large_median$Conc, 0.5)

allFail.tier2_large_median_hc5 <- c(pred_allFail.tier2_large_median$est[5])
pred_allFail.tier2_large_median$est_format <-format(pred_allFail.tier2_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
allFail.tier2_large_median_ggplot <- ggplot(pred_allFail.tier2_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier2_large_median_ggplot
```

#### allFail.tier2_large_mean

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_large_mean <- ssd_fit_dists(allFail.tier2_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_large_mean) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_large_mean <- as.data.frame(ssd_gof(dists_allFail.tier2_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_large_mean <- predict(dists_allFail.tier2_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_large_mean <- allFail.tier2_large_mean[order(allFail.tier2_large_mean$Conc), ]
SSD_allFail.tier2_large_mean$frac <- ppoints(allFail.tier2_large_mean$Conc, 0.5)

allFail.tier2_large_mean_hc5 <- c(pred_allFail.tier2_large_mean$est[5])
pred_allFail.tier2_large_mean$est_format <-format(pred_allFail.tier2_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
allFail.tier2_large_mean_ggplot <- ggplot(pred_allFail.tier2_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier2_large_mean_ggplot
```

#### allFail.tier2_large_1q
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_large_1q <- ssd_fit_dists(allFail.tier2_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_large_1q) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_large_1q <- as.data.frame(ssd_gof(dists_allFail.tier2_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_large_1q <- predict(dists_allFail.tier2_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_large_1q <- allFail.tier2_large_1q[order(allFail.tier2_large_1q$Conc), ]
SSD_allFail.tier2_large_1q$frac <- ppoints(allFail.tier2_large_1q$Conc, 0.5)

allFail.tier2_large_1q_hc5 <- c(pred_allFail.tier2_large_1q$est[5])
pred_allFail.tier2_large_1q$est_format <-format(pred_allFail.tier2_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier2_large_1q_ggplot <- ggplot(pred_allFail.tier2_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier2_large_1q_ggplot
```

#### allFail.tier2_large_min
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_large_min <- ssd_fit_dists(allFail.tier2_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_large_min) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_large_min <- as.data.frame(ssd_gof(dists_allFail.tier2_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_large_min <- predict(dists_allFail.tier2_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_large_min <- allFail.tier2_large_min[order(allFail.tier2_large_min$Conc), ]
SSD_allFail.tier2_large_min$frac <- ppoints(allFail.tier2_large_min$Conc, 0.5)

allFail.tier2_large_min_hc5 <- c(pred_allFail.tier2_large_min$est[5])
pred_allFail.tier2_large_min$est_format <-format(pred_allFail.tier2_large_min$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier2_large_min_ggplot <- ggplot(pred_allFail.tier2_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier2_large_min_ggplot
```
### Small (1-10 um) 
#### allFail.tier2_small_median

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_small_median <- ssd_fit_dists(allFail.tier2_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_small_median) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_small_median <- as.data.frame(ssd_gof(dists_allFail.tier2_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_small_median <- predict(dists_allFail.tier2_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_small_median <- allFail.tier2_small_median[order(allFail.tier2_small_median$Conc), ]
SSD_allFail.tier2_small_median$frac <- ppoints(allFail.tier2_small_median$Conc, 0.5)

allFail.tier2_small_median_hc5 <- c(pred_allFail.tier2_small_median$est[5])
pred_allFail.tier2_small_median$est_format <-format(pred_allFail.tier2_small_median$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier2_small_median_ggplot <- ggplot(pred_allFail.tier2_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier2_small_median_ggplot
```

#### allFail.tier2_small_mean

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_small_mean <- ssd_fit_dists(allFail.tier2_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_small_mean) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_small_mean <- as.data.frame(ssd_gof(dists_allFail.tier2_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_small_mean <- predict(dists_allFail.tier2_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_small_mean <- allFail.tier2_small_mean[order(allFail.tier2_small_mean$Conc), ]
SSD_allFail.tier2_small_mean$frac <- ppoints(allFail.tier2_small_mean$Conc, 0.5)

allFail.tier2_small_mean_hc5 <- c(pred_allFail.tier2_small_mean$est[5])
pred_allFail.tier2_small_mean$est_format <-format(pred_allFail.tier2_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
allFail.tier2_small_mean_ggplot <- ggplot(pred_allFail.tier2_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier2_small_mean_ggplot
```

#### allFail.tier2_small_1q
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_small_1q <- ssd_fit_dists(allFail.tier2_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_small_1q) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_small_1q <- as.data.frame(ssd_gof(dists_allFail.tier2_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_small_1q <- predict(dists_allFail.tier2_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_small_1q <- allFail.tier2_small_1q[order(allFail.tier2_small_1q$Conc), ]
SSD_allFail.tier2_small_1q$frac <- ppoints(allFail.tier2_small_1q$Conc, 0.5)

allFail.tier2_small_1q_hc5 <- c(pred_allFail.tier2_small_1q$est[5])
pred_allFail.tier2_small_1q$est_format <-format(pred_allFail.tier2_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier2_small_1q_ggplot <- ggplot(pred_allFail.tier2_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier2_small_1q_ggplot
```

#### allFail.tier2_small_min
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier2_small_min <- ssd_fit_dists(allFail.tier2_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier2_small_min) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier2_small_min <- as.data.frame(ssd_gof(dists_allFail.tier2_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier2_small_min <- predict(dists_allFail.tier2_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier2_small_min <- allFail.tier2_small_min[order(allFail.tier2_small_min$Conc), ]
SSD_allFail.tier2_small_min$frac <- ppoints(allFail.tier2_small_min$Conc, 0.5)

allFail.tier2_small_min_hc5 <- c(pred_allFail.tier2_small_min$est[5])
pred_allFail.tier2_small_min$est_format <-format(pred_allFail.tier2_small_min$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier2_small_min_ggplot <- ggplot(pred_allFail.tier2_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier2_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier2_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier2_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier2_small_min_ggplot
```

## allFail.tier 3
### Large (10 - 5000 um) 
#### allFail.tier3.4_large_median

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_large_median <- ssd_fit_dists(allFail.tier3.4_large_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_large_median) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_large_median <- as.data.frame(ssd_gof(dists_allFail.tier3.4_large_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_large_median <- predict(dists_allFail.tier3.4_large_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_large_median <- allFail.tier3.4_large_median[order(allFail.tier3.4_large_median$Conc), ]
SSD_allFail.tier3.4_large_median$frac <- ppoints(allFail.tier3.4_large_median$Conc, 0.5)

allFail.tier3.4_large_median_hc5 <- c(pred_allFail.tier3.4_large_median$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_large_median_hc10 <- c(pred_allFail.tier3.4_large_median$est[10])
pred_allFail.tier3.4_large_median$est_format <-format(pred_allFail.tier3.4_large_median$est, digits = 3, scientific = TRUE)
```


```{r}
allFail.tier3.4_large_median_ggplot <- ggplot(pred_allFail.tier3.4_large_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_large_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_large_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_large_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier3.4_large_median_ggplot
```

#### allFail.tier3.4_large_mean

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_large_mean <- ssd_fit_dists(allFail.tier3.4_large_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_large_mean) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_large_mean <- as.data.frame(ssd_gof(dists_allFail.tier3.4_large_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_large_mean <- predict(dists_allFail.tier3.4_large_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_large_mean <- allFail.tier3.4_large_mean[order(allFail.tier3.4_large_mean$Conc), ]
SSD_allFail.tier3.4_large_mean$frac <- ppoints(allFail.tier3.4_large_mean$Conc, 0.5)

allFail.tier3.4_large_mean_hc5 <- c(pred_allFail.tier3.4_large_mean$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_large_mean_hc10 <- c(pred_allFail.tier3.4_large_mean$est[10])

pred_allFail.tier3.4_large_mean$est_format <-format(pred_allFail.tier3.4_large_mean$est, digits = 3, scientific = TRUE)
```

```{r}
allFail.tier3.4_large_mean_ggplot <- ggplot(pred_allFail.tier3.4_large_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_large_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_large_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_large_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier3.4_large_mean_ggplot
```

#### allFail.tier3.4_large_1q
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_large_1q <- ssd_fit_dists(allFail.tier3.4_large_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_large_1q) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_large_1q <- as.data.frame(ssd_gof(dists_allFail.tier3.4_large_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_large_1q <- predict(dists_allFail.tier3.4_large_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_large_1q <- allFail.tier3.4_large_1q[order(allFail.tier3.4_large_1q$Conc), ]
SSD_allFail.tier3.4_large_1q$frac <- ppoints(allFail.tier3.4_large_1q$Conc, 0.5)

allFail.tier3.4_large_1q_hc5 <- c(pred_allFail.tier3.4_large_1q$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_large_1q_hc10 <- c(pred_allFail.tier3.4_large_1q$est[10])
pred_allFail.tier3.4_large_1q$est_format <-format(pred_allFail.tier3.4_large_1q$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier3.4_large_1q_ggplot <- ggplot(pred_allFail.tier3.4_large_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_large_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_large_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_large_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier3.4_large_1q_ggplot
```

#### allFail.tier3.4_large_min
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_large_min <- ssd_fit_dists(allFail.tier3.4_large_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_large_min) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_large_min <- as.data.frame(ssd_gof(dists_allFail.tier3.4_large_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_large_min <- predict(dists_allFail.tier3.4_large_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_large_min <- allFail.tier3.4_large_min[order(allFail.tier3.4_large_min$Conc), ]
SSD_allFail.tier3.4_large_min$frac <- ppoints(allFail.tier3.4_large_min$Conc, 0.5)

allFail.tier3.4_large_min_hc5 <- c(pred_allFail.tier3.4_large_min$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_large_min_hc10 <- c(pred_allFail.tier3.4_large_min$est[10])
pred_allFail.tier3.4_large_min$est_format <-format(pred_allFail.tier3.4_large_min$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier3.4_large_min_ggplot <- ggplot(pred_allFail.tier3.4_large_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_large_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_large_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_large_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier3.4_large_min_ggplot
```

### Small (1-10 um) 
#### allFail.tier3.4_small_median

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_small_median <- ssd_fit_dists(allFail.tier3.4_small_median, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_small_median) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_small_median <- as.data.frame(ssd_gof(dists_allFail.tier3.4_small_median)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_small_median <- predict(dists_allFail.tier3.4_small_median, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_small_median <- allFail.tier3.4_small_median[order(allFail.tier3.4_small_median$Conc), ]
SSD_allFail.tier3.4_small_median$frac <- ppoints(allFail.tier3.4_small_median$Conc, 0.5)

allFail.tier3.4_small_median_hc5 <- c(pred_allFail.tier3.4_small_median$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_small_median_hc10 <- c(pred_allFail.tier3.4_small_median$est[10])

pred_allFail.tier3.4_small_median$est_format <-format(pred_allFail.tier3.4_small_median$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier3.4_small_median_ggplot <- ggplot(pred_allFail.tier3.4_small_median,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_small_median,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_small_median, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_small_median") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier3.4_small_median_ggplot
```

#### allFail.tier3.4_small_mean

```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_small_mean <- ssd_fit_dists(allFail.tier3.4_small_mean, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_small_mean) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_small_mean <- as.data.frame(ssd_gof(dists_allFail.tier3.4_small_mean)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_small_mean <- predict(dists_allFail.tier3.4_small_mean, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_small_mean <- allFail.tier3.4_small_mean[order(allFail.tier3.4_small_mean$Conc), ]
SSD_allFail.tier3.4_small_mean$frac <- ppoints(allFail.tier3.4_small_mean$Conc, 0.5)

allFail.tier3.4_small_mean_hc5 <- c(pred_allFail.tier3.4_small_mean$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_small_mean_hc10 <- c(pred_allFail.tier3.4_small_mean$est[10])

pred_allFail.tier3.4_small_mean$est_format <-format(pred_allFail.tier3.4_small_mean$est, digits = 3, scientific = TRUE)

## ggplot
allFail.tier3.4_small_mean_ggplot <- ggplot(pred_allFail.tier3.4_small_mean,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_small_mean,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_small_mean, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_small_mean") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme
allFail.tier3.4_small_mean_ggplot
```

#### allFail.tier3.4_small_1q
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_small_1q <- ssd_fit_dists(allFail.tier3.4_small_1q, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_small_1q) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_small_1q <- as.data.frame(ssd_gof(dists_allFail.tier3.4_small_1q)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_small_1q <- predict(dists_allFail.tier3.4_small_1q, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_small_1q <- allFail.tier3.4_small_1q[order(allFail.tier3.4_small_1q$Conc), ]
SSD_allFail.tier3.4_small_1q$frac <- ppoints(allFail.tier3.4_small_1q$Conc, 0.5)

allFail.tier3.4_small_1q_hc5 <- c(pred_allFail.tier3.4_small_1q$est[5])
#extrac hc10 (allFail.tier 4)
allFail.tier3.4_small_1q_hc10 <- c(pred_allFail.tier3.4_small_1q$est[10])

pred_allFail.tier3.4_small_1q$est_format <-format(pred_allFail.tier3.4_small_1q$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier3.4_small_1q_ggplot <- ggplot(pred_allFail.tier3.4_small_1q,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_small_1q,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_small_1q, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_small_1q") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier3.4_small_1q_ggplot
```

#### allFail.tier3.4_small_min
```{r include=FALSE}
###### --modelling ####
dists_allFail.tier3.4_small_min <- ssd_fit_dists(allFail.tier3.4_small_min, left = "Conc", dists = c("weibull", "llogis", "lnorm", "gamma", "lgumbel"), computable = FALSE, silent = FALSE) 

#autoplot(dists_allFail.tier3.4_small_min) #plots the distribution in ggploallFail.tier2
#### Goodness of fit ####
gof_allFail.tier3.4_small_min <- as.data.frame(ssd_gof(dists_allFail.tier3.4_small_min)) %>% mutate_if(is.numeric, ~ signif(., 3))

#### Prediction ####
set.seed(99)
pred_allFail.tier3.4_small_min <- predict(dists_allFail.tier3.4_small_min, average = TRUE, ic = "aicc", nboot = 10, ci= TRUE) 

#order data
SSD_allFail.tier3.4_small_min <- allFail.tier3.4_small_min[order(allFail.tier3.4_small_min$Conc), ]
SSD_allFail.tier3.4_small_min$frac <- ppoints(allFail.tier3.4_small_min$Conc, 0.5)

#extract hc5
allFail.tier3.4_small_min_hc5 <- c(pred_allFail.tier3.4_small_min$est[5])

#extrac hc10 (allFail.tier 4)
allFail.tier3.4_small_min_hc10 <- c(pred_allFail.tier3.4_small_min$est[10])
pred_allFail.tier3.4_small_min$est_format <-format(pred_allFail.tier3.4_small_min$est, digits = 3, scientific = TRUE)

#ggplot
allFail.tier3.4_small_min_ggplot <- ggplot(pred_allFail.tier3.4_small_min,aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, color = "blue", fill = "lightblue") +
      geom_line(aes_string(y = "percent/100"), color = "gray") +
      geom_point(data = SSD_allFail.tier3.4_small_min,aes(x = Conc, y =frac, color = Group)) + 
      geom_text_repel(data = SSD_allFail.tier3.4_small_min, aes(x = Conc, y = frac, label = Species, color = Group), nudge_x = 0.2, size = 3, segment.alpha = 0.5) + 
      scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) + 
  labs(title = "allFail.tier3.4_small_min") +
      fill.type + #user-selected
      color.type + #user-selected
      theme.type #user theme

allFail.tier3.4_small_min_ggplot
```

# Combine plots
## allFail.tier 1
### Small (1-10 um)s
```{r}
### allFail.tier1_small_median
ggplot(pred_allFail.tier1_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_allFail.tier1_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: allFail.tier1_small_mean ###
  geom_xribbon(data = pred_allFail.tier1_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_allFail.tier1_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_allFail.tier1_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: allFail.tier1_small_1q ###
    geom_xribbon(data = pred_allFail.tier1_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_allFail.tier1_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_allFail.tier1_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
### fourth line: allFail.tier1_small_min ###
    geom_xribbon(data = pred_allFail.tier1_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_allFail.tier1_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_allFail.tier1_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (allFail.tier 1)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### allFail.tier1_large_median
ggplot(pred_allFail.tier1_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_allFail.tier1_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: allFail.tier1_large_mean ###
  geom_xribbon(data = pred_allFail.tier1_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_allFail.tier1_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_allFail.tier1_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: allFail.tier1_large_1q ###
    geom_xribbon(data = pred_allFail.tier1_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_allFail.tier1_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_allFail.tier1_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
  ### fourth line: allFail.tier1_large_min ###
    geom_xribbon(data = pred_allFail.tier1_large_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_allFail.tier1_large_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_allFail.tier1_large_min, aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (allFail.tier 1)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## allFail.tier 2
### Small (1-10 um)s
```{r}
### allFail.tier2_small_median
ggplot(pred_allFail.tier2_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_allFail.tier2_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: allFail.tier2_small_mean ###
  geom_xribbon(data = pred_allFail.tier2_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_allFail.tier2_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_allFail.tier2_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: allFail.tier2_small_1q ###
    geom_xribbon(data = pred_allFail.tier2_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_allFail.tier2_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_allFail.tier2_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  ### fourth line: allFail.tier2_small_min  ###
    geom_xribbon(data = pred_allFail.tier2_small_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_allFail.tier2_small_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_allFail.tier2_small_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
  ### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (allFail.tier 2)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### allFail.tier2_large_median
ggplot(pred_allFail.tier2_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_allFail.tier2_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: allFail.tier2_large_mean ###
  geom_xribbon(data = pred_allFail.tier2_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_allFail.tier2_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_allFail.tier2_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: allFail.tier2_large_1q  ###
    geom_xribbon(data = pred_allFail.tier2_large_1q , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_allFail.tier2_large_1q , aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_allFail.tier2_large_1q , aes(x = Conc, y =frac), 
                 color = "green") +  
  
    ### fourth line: allFail.tier2_large_min  ###
    geom_xribbon(data = pred_allFail.tier2_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_allFail.tier2_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_allFail.tier2_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (allFail.tier 2)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```

## allFail.tier 3/4
### Small (1-10 um)s
```{r}
### allFail.tier3.4_small_median
ggplot(pred_allFail.tier3.4_small_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_allFail.tier3.4_small_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: allFail.tier3.4_small_mean ###
  geom_xribbon(data = pred_allFail.tier3.4_small_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_allFail.tier3.4_small_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_allFail.tier3.4_small_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: allFail.tier3.4_small_1q ###
    geom_xribbon(data = pred_allFail.tier3.4_small_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_allFail.tier3.4_small_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_allFail.tier3.4_small_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: allFail.tier3.4_small_min ###
    geom_xribbon(data = pred_allFail.tier3.4_small_min, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_allFail.tier3.4_small_min, aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_allFail.tier3.4_small_min, aes(x = Conc, y =frac), 
                 color = "grey10") + 
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (allFail.tier 3/4)",
       subtitle = ("Size Range: 1 - 10 um; Red = median, blue = mean, green = first quartile, grey = min"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
### Large (10 - 5000 um)s
```{r}
### allFail.tier3.4_large_median
ggplot(pred_allFail.tier3.4_large_median, aes_string(x = "est")) +
      geom_xribbon(aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
                   color = "red", fill = "red") +
      geom_line(aes_string(y = "percent/100"), 
                color = "red") +
      geom_point(data = SSD_allFail.tier3.4_large_median,aes(x = Conc, y =frac), 
                 color = "red") + 
      
### second line: allFail.tier3.4_large_mean ###
  geom_xribbon(data = pred_allFail.tier3.4_large_mean, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "blue", fill = "blue") +
      geom_line(data = pred_allFail.tier3.4_large_mean, aes_string(y = "percent/100"), 
                color = "blue") +
      geom_point(data = SSD_allFail.tier3.4_large_mean, aes(x = Conc, y =frac), 
                 color = "blue") +  
### third line: allFail.tier3.4_large_1q ###
    geom_xribbon(data = pred_allFail.tier3.4_large_1q, aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "green", fill = "green") +
      geom_line(data = pred_allFail.tier3.4_large_1q, aes_string(y = "percent/100"), 
                color = "green") +
      geom_point(data = SSD_allFail.tier3.4_large_1q, aes(x = Conc, y =frac), 
                 color = "green") +  
  
      ### fourth line: allFail.tier3.4_large_min  ###
    geom_xribbon(data = pred_allFail.tier3.4_large_min , aes_string(xmin = "lcl", xmax = "ucl", y = "percent/100"), alpha = 0.2, 
               color = "grey10", fill = "grey10") +
      geom_line(data = pred_allFail.tier3.4_large_min , aes_string(y = "percent/100"), 
                color = "grey10") +
      geom_point(data = SSD_allFail.tier3.4_large_min , aes(x = Conc, y =frac), 
                 color = "grey10") +  
### plot parameters ###
  scale_y_continuous("Species Affected (%)", labels = scales::percent, limits = c(0,1)) +
      xlab(particle_mass_check_ssd)+
      coord_trans(x = "log10") +
      scale_x_continuous(breaks = scales::trans_breaks("log10", function(x) 10^x, n = 15),
                         labels = trans_format("log10", scales::math_format(10^.x))) +
  labs(title = "Species Sensitivity Distributions by Data Collapsing (allFail.tier 3/4)",
       subtitle = ("Size Range: 10 - 5,000 um; Red = median, blue = mean, green = first quartile, grey = minimum"),
       caption = ("All endpoints")) +
  theme.type +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5, size = 20),
        axis.title = element_text(size = 16),
        axis.text =  element_text(size = 16),
        legend.text = element_text(size =14),
        legend.title = element_blank(),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```
## Summary Table
```{r}
# Small/Large x allFail.tier 1/2/3 x median/mean/q1 = 2 x 3 x 3 = 18 comparisons
larges <- list(allFail.tier1_large_median_hc5, allFail.tier1_large_mean_hc5, allFail.tier1_large_1q_hc5, allFail.tier1_large_min_hc5,
              allFail.tier1_large.obs[[1,1]], #n.obs
              allFail.tier1_large.obs[[1,2]], #n.studies
              allFail.tier1_large.obs[[1,3]], #n.taxa
              allFail.tier1_large.obs[[1,4]], #n.species
          #allFail.tier 2
          allFail.tier2_large_median_hc5, allFail.tier2_large_mean_hc5, allFail.tier2_large_1q_hc5, allFail.tier2_large_min_hc5,
          allFail.tier2_large.obs[[1,1]], #n.obs
          allFail.tier2_large.obs[[1,2]], #n.studies
          allFail.tier2_large.obs[[1,3]], #n.taxa
          allFail.tier2_large.obs[[1,4]], #n.species
          #allFail.tier 3 (hc5)
          allFail.tier3.4_large_median_hc5, allFail.tier3.4_large_mean_hc5, allFail.tier3.4_large_1q_hc5, allFail.tier3.4_large_min_hc5,
          allFail.tier3.4_large.obs[[1,1]], #n.obs
          allFail.tier3.4_large.obs[[1,2]], #n.studies
          allFail.tier3.4_large.obs[[1,3]], #n.taxa
          allFail.tier3.4_large.obs[[1,4]], #n.species
          #allFail.tier 4 (hc10)
          allFail.tier3.4_large_median_hc10, allFail.tier3.4_large_mean_hc10, allFail.tier3.4_large_1q_hc10, allFail.tier3.4_large_min_hc10,
          allFail.tier3.4_large.obs[[1,1]], #n.obs
          allFail.tier3.4_large.obs[[1,2]], #n.studies
          allFail.tier3.4_large.obs[[1,3]], #n.taxa
          allFail.tier3.4_large.obs[[1,4]]  #n.species
          )

smalls <- list(allFail.tier1_small_median_hc5, allFail.tier1_small_mean_hc5, allFail.tier1_small_1q_hc5, allFail.tier1_small_min_hc5,
               allFail.tier1_small.obs[[1,1]], #n.obs
               allFail.tier1_small.obs[[1,2]], #n.studies
               allFail.tier1_small.obs[[1,3]], #n.taxa
               allFail.tier1_small.obs[[1,4]], #n.species
          #allFail.tier 2
          allFail.tier2_small_median_hc5, allFail.tier2_small_mean_hc5, allFail.tier2_small_1q_hc5, allFail.tier2_small_min_hc5,
          allFail.tier2_small.obs[[1,1]], #n.obs
          allFail.tier2_small.obs[[1,2]], #n.studies
          allFail.tier2_small.obs[[1,3]], #n.taxa
          allFail.tier2_small.obs[[1,4]], #n.species
          #allFail.tier 3 (hc5)
          allFail.tier3.4_small_median_hc5, allFail.tier3.4_small_mean_hc5, allFail.tier3.4_small_1q_hc5, allFail.tier3.4_small_min_hc5,
          allFail.tier3.4_small.obs[[1,1]], #n.obs
          allFail.tier3.4_small.obs[[1,2]], #n.studies
          allFail.tier3.4_small.obs[[1,3]], #n.taxa
          allFail.tier3.4_small.obs[[1,4]], #n.species
          #allFail.tier 4 (hc10)
          allFail.tier3.4_small_median_hc10, allFail.tier3.4_small_mean_hc10, allFail.tier3.4_small_1q_hc10, allFail.tier3.4_small_min_hc10,
          allFail.tier3.4_small.obs[[1,1]], #n.obs
          allFail.tier3.4_small.obs[[1,2]], #n.studies
          allFail.tier3.4_small.obs[[1,3]], #n.taxa
          allFail.tier3.4_small.obs[[1,4]]  #n.species
          )

## Conver to data frames
largesdf <- data.frame(t(matrix(unlist(larges), ncol = 4)))
smallsdf <- data.frame(t(matrix(unlist(smalls), ncol = 4))) #t = transpose

# convert mg/L to ug/L
largesdf <- largesdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

smallsdf <- smallsdf %>% 
  mutate_at(c(1:4), as.numeric) %>%
  mutate_at(c(1:4), funs(. * 1000)) %>% #don't convert n.obs and n.doi
  mutate_at(c(5:6), as.character) #make sure DOI and n are characters so they don't get color coded below

# rename columns and rows
colnames(largesdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")
colnames(smallsdf) <- c("Median", "Mean", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")

rownames(largesdf) <- c("Tier 1", "Tier 2", "Tier 3", "Tier 4")
rownames(smallsdf) <- c("Tier 1", "Tier 2", "Tier 3", "Tier 4")

# provide tier column
largestibble <- tibble(largesdf,
                       Tier = rownames(largesdf))

#re-arrange columns
largestibble <- largestibble[c("Tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

# provide tier column
smallstibble <- tibble(smallsdf,
                       Tier = rownames(smallsdf))

#re-arrange columns
smallstibble <- smallstibble[c("Tier", "Mean", "Median", "Quartile_1", "Minimum", "N_Obs.", "N_Doi", "N_Taxa", "N_Species")]

#function to create tables
hp_table <- function(x){
  #get full value range for whole table conditional formatting
  full_val_range <- x %>% 
    ungroup %>% 
    select_if(is.numeric) %>% 
    range
  
  #format colors accordingly
  gt(x) %>% 
    fmt_number(columns = vars(Mean, Median, Quartile_1, Minimum),
             n_sigfig = 2,
             use_seps = TRUE) %>% 
    data_color(
    columns = names(x)[2:5],
    colors = scales::col_numeric(
      palette = paletteer::paletteer_d(palette = "ggsci::teal_material") %>% as.character(),
      domain = full_val_range),
    alpha = 0.75) %>% 
    tab_options(column_labels.hidden = FALSE) %>% 
    as_raw_html() # return as html
}

#larges gt
larges_gt <- largestibble %>% 
  hp_table()

#smalls gt
smalls_gt <- smallstibble %>% 
  hp_table() 
  
## Combine
data.tables <- data.frame(smalls_table = smalls_gt,
                          larges_table = larges_gt)
#Combine
allFail.summary <- data.tables %>% 
  gt() %>% 
  fmt_markdown(columns = TRUE) %>% 
  cols_label(smalls_table = "1-10 um",
             larges_table = "10-5,000 um") %>% 
  tab_source_note(md("Calculated from SSDs")) %>% 
  tab_header(title = paste("Microplastics HC5", particle_mass_check_ssd, "by Data Collapse and Tier"),
             subtitle = "Qualiter Filters: Risk (pass & fail); Tech (pass & fail)") 
#print
allFail.summary
```

# Grand Summary Table
```{r}
## Combine data tables from all quality tiers
data.tables <- data.frame(allPass = allPass.summary,
                          risk.pass = risk.pass.summary,
                          tech.pass = tech.pass.summary,
                          allFail = allFail.summary)
#Combine
data.tables %>% 
  gt() %>% 
  fmt_markdown(columns = TRUE) #%>% 
  #cols_label(allPass = "Risk and Tech Tier Pass",
   #          risk.pass = "Risk Pass; Tech Pass & Fail",
    #         tech.pass = "Risk Pass & Fail; Tech Fail",
     #        allFail = "Risk Pass & Fail; Tech Pass & Fail")
```

